(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/**
* matter-0.8.0.min.js 0.8.0-alpha 2014-05-04
* http://brm.io/matter-js/
* License: MIT
*/

!function(){var a={},b={};!function(){var a=1;b.create=function(a){var b={id:o.nextId(),type:"body",label:"Body",angle:0,vertices:z.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionAir:.01,groupId:0,slop:.05,timeScale:1,render:{visible:!0,sprite:{xScale:1,yScale:1},lineWidth:1.5}},d=o.extend(b,a);return c(d),d},b.nextGroupId=function(){return a++};var c=function(a){a.axes=a.axes||w.fromVertices(a.vertices),a.area=z.area(a.vertices),a.bounds=x.create(a.vertices),a.mass=a.mass||a.density*a.area,a.inverseMass=1/a.mass,a.inertia=a.inertia||z.inertia(a.vertices,a.mass),a.inverseInertia=1/a.inertia,a.positionPrev=a.positionPrev||{x:a.position.x,y:a.position.y},a.anglePrev=a.anglePrev||a.angle,a.render.fillStyle=a.render.fillStyle||(a.isStatic?"#eeeeee":o.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"])),a.render.strokeStyle=a.render.strokeStyle||o.shadeColor(a.render.fillStyle,-20),z.create(a.vertices,a);var c=z.centre(a.vertices);z.translate(a.vertices,a.position),z.translate(a.vertices,c,-1),z.rotate(a.vertices,a.angle,a.position),w.rotate(a.axes,a.angle),x.update(a.bounds,a.vertices,a.velocity),b.setStatic(a,a.isStatic),t.set(a,a.isSleeping)};b.setStatic=function(a,b){a.isStatic=b,b&&(a.restitution=0,a.friction=1,a.mass=a.inertia=a.density=1/0,a.inverseMass=a.inverseInertia=0,a.render.lineWidth=1,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.angularVelocity=0,a.speed=0,a.angularSpeed=0,a.motion=0)},b.resetForcesAll=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.force.x=0,c.force.y=0,c.torque=0}},b.applyGravityAll=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.isStatic||d.isSleeping||(d.force.y+=d.mass*b.y*.001,d.force.x+=d.mass*b.x*.001)}},b.updateAll=function(a,c,d,e,f){for(var g=0;g<a.length;g++){var h=a[g];h.isStatic||h.isSleeping||h.bounds.max.x<f.min.x||h.bounds.min.x>f.max.x||h.bounds.max.y<f.min.y||h.bounds.min.y>f.max.y||b.update(h,c,d,e)}},b.update=function(a,b,c,d){var e=Math.pow(b*c*a.timeScale,2),f=1-a.frictionAir*c*a.timeScale,g=a.position.x-a.positionPrev.x,h=a.position.y-a.positionPrev.y;a.velocity.x=g*f*d+a.force.x/a.mass*e,a.velocity.y=h*f*d+a.force.y/a.mass*e,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.position.x+=a.velocity.x,a.position.y+=a.velocity.y,a.angularVelocity=(a.angle-a.anglePrev)*f*d+a.torque/a.inertia*e,a.anglePrev=a.angle,a.angle+=a.angularVelocity,a.speed=y.magnitude(a.velocity),a.angularSpeed=Math.abs(a.angularVelocity),z.translate(a.vertices,a.velocity),0!==a.angularVelocity&&(z.rotate(a.vertices,a.angularVelocity,a.position),w.rotate(a.axes,a.angularVelocity)),x.update(a.bounds,a.vertices,a.velocity)},b.applyForce=function(a,b,c){a.force.x+=c.x,a.force.y+=c.y;var d={x:b.x-a.position.x,y:b.y-a.position.y};a.torque+=(d.x*c.y-d.y*c.x)*a.inverseInertia},b.translate=function(a,b){a.positionPrev.x+=b.x,a.positionPrev.y+=b.y,a.position.x+=b.x,a.position.y+=b.y,z.translate(a.vertices,b),x.update(a.bounds,a.vertices,a.velocity)},b.rotate=function(a,b){a.anglePrev+=b,a.angle+=b,z.rotate(a.vertices,b,a.position),w.rotate(a.axes,b),x.update(a.bounds,a.vertices,a.velocity)},b.scale=function(a,b,c,d){z.scale(a.vertices,b,c,d),a.axes=w.fromVertices(a.vertices),a.area=z.area(a.vertices),a.mass=a.density*a.area,a.inverseMass=1/a.mass,z.translate(a.vertices,{x:-a.position.x,y:-a.position.y}),a.inertia=z.inertia(a.vertices,a.mass),a.inverseInertia=1/a.inertia,z.translate(a.vertices,{x:a.position.x,y:a.position.y}),x.update(a.bounds,a.vertices,a.velocity)}}();var c={};!function(){c.create=function(a){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},a)},c.setModified=function(a,b,d,e){if(a.isModified=b,d&&a.parent&&c.setModified(a.parent,b,d,e),e)for(var f=0;f<a.composites.length;f++){var g=a.composites[f];c.setModified(g,b,d,e)}},c.add=function(a,b){for(var d=[].concat(b),e=0;e<d.length;e++){var f=d[e];switch(f.type){case"body":c.addBody(a,f);break;case"constraint":c.addConstraint(a,f);break;case"composite":c.addComposite(a,f);break;case"mouseConstraint":c.addConstraint(a,f.constraint)}}return a},c.remove=function(a,b,d){for(var e=[].concat(b),f=0;f<e.length;f++){var g=e[f];switch(g.type){case"body":c.removeBody(a,g,d);break;case"constraint":c.removeConstraint(a,g,d);break;case"composite":c.removeComposite(a,g,d);break;case"mouseConstraint":c.removeConstraint(a,g.constraint)}}return a},c.addComposite=function(a,b){return a.composites.push(b),b.parent=a,c.setModified(a,!0,!0,!1),a},c.removeComposite=function(a,b,d){var e=a.composites.indexOf(b);if(-1!==e&&(c.removeCompositeAt(a,e),c.setModified(a,!0,!0,!1)),d)for(var f=0;f<a.composites.length;f++)c.removeComposite(a.composites[f],b,!0);return a},c.removeCompositeAt=function(a,b){return a.composites.splice(b,1),c.setModified(a,!0,!0,!1),a},c.addBody=function(a,b){return a.bodies.push(b),c.setModified(a,!0,!0,!1),a},c.removeBody=function(a,b,d){var e=a.bodies.indexOf(b);if(-1!==e&&(c.removeBodyAt(a,e),c.setModified(a,!0,!0,!1)),d)for(var f=0;f<a.composites.length;f++)c.removeBody(a.composites[f],b,!0);return a},c.removeBodyAt=function(a,b){return a.bodies.splice(b,1),c.setModified(a,!0,!0,!1),a},c.addConstraint=function(a,b){return a.constraints.push(b),c.setModified(a,!0,!0,!1),a},c.removeConstraint=function(a,b,d){var e=a.constraints.indexOf(b);if(-1!==e&&c.removeConstraintAt(a,e),d)for(var f=0;f<a.composites.length;f++)c.removeConstraint(a.composites[f],b,!0);return a},c.removeConstraintAt=function(a,b){return a.constraints.splice(b,1),c.setModified(a,!0,!0,!1),a},c.clear=function(a,b,d){if(d)for(var e=0;e<a.composites.length;e++)c.clear(a.composites[e],b,!0);return b?a.bodies=a.bodies.filter(function(a){return a.isStatic}):a.bodies.length=0,a.constraints.length=0,a.composites.length=0,c.setModified(a,!0,!0,!1),a},c.allBodies=function(a){for(var b=[].concat(a.bodies),d=0;d<a.composites.length;d++)b=b.concat(c.allBodies(a.composites[d]));return b},c.allConstraints=function(a){for(var b=[].concat(a.constraints),d=0;d<a.composites.length;d++)b=b.concat(c.allConstraints(a.composites[d]));return b},c.allComposites=function(a){for(var b=[].concat(a.composites),d=0;d<a.composites.length;d++)b=b.concat(c.allComposites(a.composites[d]));return b},c.get=function(a,b,d){var e,f;switch(d){case"body":e=c.allBodies(a);break;case"constraint":e=c.allConstraints(a);break;case"composite":e=c.allComposites(a).concat(a)}return e?(f=e.filter(function(a){return a.id.toString()===b.toString()}),0===f.length?null:f[0]):null},c.move=function(a,b,d){return c.remove(a,b),c.add(d,b),a},c.rebase=function(a){for(var b=c.allBodies(a).concat(c.allConstraints(a)).concat(c.allComposites(a)),d=0;d<b.length;d++)b[d].id=o.nextId();return c.setModified(a,!0,!0,!1),a}}();var d={};!function(){d.create=function(a){var b=c.create(),d={label:"World",gravity:{x:0,y:1},bounds:{min:{x:0,y:0},max:{x:800,y:600}}};return o.extend(b,d,a)}}();var e={};!function(){e.create=function(a){return{id:e.id(a),vertex:a,normalImpulse:0,tangentImpulse:0}},e.id=function(a){return a.body.id+"_"+a.index}}();var f={};!function(){f.collisions=function(a,b){for(var c=[],d=b.metrics,e=b.pairs.table,f=0;f<a.length;f++){var g=a[f][0],i=a[f][1];if(!(g.groupId&&i.groupId&&g.groupId===i.groupId||(g.isStatic||g.isSleeping)&&(i.isStatic||i.isSleeping)||(d.midphaseTests+=1,!x.overlaps(g.bounds,i.bounds)))){var j,k=h.id(g,i),m=e[k];j=m&&m.isActive?m.collision:null;var n=l.collides(g,i,j);d.narrowphaseTests+=1,n.reused&&(d.narrowReuseCount+=1),n.collided&&(c.push(n),d.narrowDetections+=1)}}return c},f.bruteForce=function(a,b){for(var c=[],d=b.metrics,e=b.pairs.table,f=0;f<a.length;f++)for(var g=f+1;g<a.length;g++){var i=a[f],j=a[g];if(!(i.groupId&&j.groupId&&i.groupId===j.groupId||(i.isStatic||i.isSleeping)&&(j.isStatic||j.isSleeping)||(d.midphaseTests+=1,!x.overlaps(i.bounds,j.bounds)))){var k,m=h.id(i,j),n=e[m];k=n&&n.isActive?n.collision:null;var o=l.collides(i,j,k);d.narrowphaseTests+=1,o.reused&&(d.narrowReuseCount+=1),o.collided&&(c.push(o),d.narrowDetections+=1)}}return c}}();var g={};!function(){g.create=function(a,b){return{buckets:{},pairs:{},pairsList:[],bucketWidth:a||48,bucketHeight:b||48}},g.update=function(c,g,h,k){var l,m,n,o,p,q=h.world,r=c.buckets,s=h.metrics,t=!1;for(s.broadphaseTests=0,l=0;l<g.length;l++){var u=g[l];if((!u.isSleeping||k)&&!(u.bounds.max.x<0||u.bounds.min.x>q.bounds.width||u.bounds.max.y<0||u.bounds.min.y>q.bounds.height)){var v=b(c,u);if(!u.region||v.id!==u.region.id||k){s.broadphaseTests+=1,(!u.region||k)&&(u.region=v);var w=a(v,u.region);for(m=w.startCol;m<=w.endCol;m++)for(n=w.startRow;n<=w.endRow;n++){p=d(m,n),o=r[p];var x=m>=v.startCol&&m<=v.endCol&&n>=v.startRow&&n<=v.endRow,y=m>=u.region.startCol&&m<=u.region.endCol&&n>=u.region.startRow&&n<=u.region.endRow;!x&&y&&y&&o&&i(c,o,u),(u.region===v||x&&!y||k)&&(o||(o=e(r,p)),f(c,o,u))}u.region=v,t=!0}}}t&&(c.pairsList=j(c))},g.clear=function(a){a.buckets={},a.pairs={},a.pairsList=[]};var a=function(a,b){var d=Math.min(a.startCol,b.startCol),e=Math.max(a.endCol,b.endCol),f=Math.min(a.startRow,b.startRow),g=Math.max(a.endRow,b.endRow);return c(d,e,f,g)},b=function(a,b){var d=b.bounds,e=Math.floor(d.min.x/a.bucketWidth),f=Math.floor(d.max.x/a.bucketWidth),g=Math.floor(d.min.y/a.bucketHeight),h=Math.floor(d.max.y/a.bucketHeight);return c(e,f,g,h)},c=function(a,b,c,d){return{id:a+","+b+","+c+","+d,startCol:a,endCol:b,startRow:c,endRow:d}},d=function(a,b){return a+","+b},e=function(a,b){var c=a[b]=[];return c},f=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];if(!(c.id===e.id||c.isStatic&&e.isStatic)){var f=h.id(c,e),g=a.pairs[f];g?g[2]+=1:a.pairs[f]=[c,e,1]}}b.push(c)},i=function(a,b,c){b.splice(b.indexOf(c),1);for(var d=0;d<b.length;d++){var e=b[d],f=h.id(c,e),g=a.pairs[f];g&&(g[2]-=1)}},j=function(a){var b,c,d=[];b=o.keys(a.pairs);for(var e=0;e<b.length;e++)c=a.pairs[b[e]],c[2]>0?d.push(c):delete a.pairs[b[e]];return d}}();var h={};!function(){h.create=function(a,b){var c=a.bodyA,d=a.bodyB,e={id:h.id(c,d),bodyA:c,bodyB:d,contacts:{},activeContacts:[],separation:0,isActive:!0,timeCreated:b,timeUpdated:b,inverseMass:c.inverseMass+d.inverseMass,friction:Math.min(c.friction,d.friction),restitution:Math.max(c.restitution,d.restitution),slop:Math.max(c.slop,d.slop)};return h.update(e,a,b),e},h.update=function(a,b,c){var d=a.contacts,f=b.supports,g=a.activeContacts;if(a.collision=b,g.length=0,b.collided){for(var i=0;i<f.length;i++){var j=f[i],k=e.id(j),l=d[k];g.push(l?l:d[k]=e.create(j))}a.separation=b.depth,h.setActive(a,!0,c)}else a.isActive===!0&&h.setActive(a,!1,c)},h.setActive=function(a,b,c){b?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.activeContacts.length=0)},h.id=function(a,b){return a.id<b.id?a.id+"_"+b.id:b.id+"_"+a.id}}();var i={};!function(){var a=1e3;i.create=function(a){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},a)},i.update=function(a,b,c){var d,e,f,g,i=a.list,j=a.table,k=a.collisionStart,l=a.collisionEnd,m=a.collisionActive,n=[];for(k.length=0,l.length=0,m.length=0,g=0;g<b.length;g++)d=b[g],d.collided&&(e=h.id(d.bodyA,d.bodyB),n.push(e),f=j[e],f?(f.isActive?m.push(f):k.push(f),h.update(f,d,c)):(f=h.create(d,c),j[e]=f,k.push(f),i.push(f)));for(g=0;g<i.length;g++)f=i[g],f.isActive&&-1===n.indexOf(f.id)&&(h.setActive(f,!1,c),l.push(f))},i.removeOld=function(b,c){var d,e,f,g,h=b.list,i=b.table,j=[];for(g=0;g<h.length;g++)d=h[g],e=d.collision,e.bodyA.isSleeping||e.bodyB.isSleeping?d.timeUpdated=c:c-d.timeUpdated>a&&j.push(g);for(g=0;g<j.length;g++)f=j[g]-g,d=h[f],delete i[d.id],h.splice(f,1)},i.clear=function(a){return a.table={},a.list.length=0,a.collisionStart.length=0,a.collisionActive.length=0,a.collisionEnd.length=0,a}}();var j={};!function(){j.ray=function(a,b,c,d){d=d||Number.MIN_VALUE;for(var e=y.angle(b,c),f=y.magnitude(y.sub(b,c)),g=.5*(c.x+b.x),h=.5*(c.y+b.y),i=u.rectangle(g,h,f,d,{angle:e}),j=[],k=0;k<a.length;k++){var m=a[k];if(x.overlaps(m.bounds,i.bounds)){var n=l.collides(m,i);n.collided&&(n.body=n.bodyA=n.bodyB=m,j.push(n))}}return j},j.region=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=x.overlaps(f.bounds,b);(g&&!c||!g&&c)&&d.push(f)}return d}}();var k={};!function(){var a=4,b=.2,c=.6;k.solvePosition=function(a,c){var d,e,f,g,h,i,j,k,l;for(d=0;d<a.length;d++)e=a[d],e.isActive&&(f=e.collision,g=f.bodyA,h=f.bodyB,i=f.supports[0],j=f.supportCorrected,k=f.normal,l=y.sub(y.add(h.positionImpulse,i),y.add(g.positionImpulse,j)),e.separation=y.dot(k,l));for(d=0;d<a.length;d++)e=a[d],e.isActive&&(f=e.collision,g=f.bodyA,h=f.bodyB,k=f.normal,positionImpulse=(e.separation*b-e.slop)*c,(g.isStatic||h.isStatic)&&(positionImpulse*=2),g.isStatic||g.isSleeping||(g.positionImpulse.x+=k.x*positionImpulse,g.positionImpulse.y+=k.y*positionImpulse),h.isStatic||h.isSleeping||(h.positionImpulse.x-=k.x*positionImpulse,h.positionImpulse.y-=k.y*positionImpulse))},k.postSolvePosition=function(a){for(var b=0;b<a.length;b++){var d=a[b];(0!==d.positionImpulse.x||0!==d.positionImpulse.y)&&(d.position.x+=d.positionImpulse.x,d.position.y+=d.positionImpulse.y,d.positionPrev.x+=d.positionImpulse.x,d.positionPrev.y+=d.positionImpulse.y,z.translate(d.vertices,d.positionImpulse),x.update(d.bounds,d.vertices,d.velocity),d.positionImpulse.x*=c,d.positionImpulse.y*=c)}},k.preSolveVelocity=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p={};for(b=0;b<a.length;b++)if(d=a[b],d.isActive)for(e=d.activeContacts,f=d.collision,g=f.bodyA,h=f.bodyB,i=f.normal,j=f.tangent,c=0;c<e.length;c++)k=e[c],l=k.vertex,m=k.normalImpulse,n=k.tangentImpulse,p.x=i.x*m+j.x*n,p.y=i.y*m+j.y*n,g.isStatic||g.isSleeping||(o=y.sub(l,g.position),g.positionPrev.x+=p.x*g.inverseMass,g.positionPrev.y+=p.y*g.inverseMass,g.anglePrev+=y.cross(o,p)*g.inverseInertia),h.isStatic||h.isSleeping||(o=y.sub(l,h.position),h.positionPrev.x-=p.x*h.inverseMass,h.positionPrev.y-=p.y*h.inverseMass,h.anglePrev-=y.cross(o,p)*h.inverseInertia)},k.solveVelocity=function(b,c){for(var d={},e=c*c,f=0;f<b.length;f++){var g=b[f];if(g.isActive){var h=g.collision,i=h.bodyA,j=h.bodyB,k=h.normal,l=h.tangent,m=g.activeContacts,n=1/m.length;i.velocity.x=i.position.x-i.positionPrev.x,i.velocity.y=i.position.y-i.positionPrev.y,j.velocity.x=j.position.x-j.positionPrev.x,j.velocity.y=j.position.y-j.positionPrev.y,i.angularVelocity=i.angle-i.anglePrev,j.angularVelocity=j.angle-j.anglePrev;for(var p=0;p<m.length;p++){var q=m[p],r=q.vertex,s=y.sub(r,i.position),t=y.sub(r,j.position),u=y.add(i.velocity,y.mult(y.perp(s),i.angularVelocity)),v=y.add(j.velocity,y.mult(y.perp(t),j.angularVelocity)),w=y.sub(u,v),x=y.dot(k,w),z=y.dot(l,w),A=Math.abs(z),B=o.sign(z),C=(1+g.restitution)*x,D=o.clamp(g.separation+x,0,1),E=z;A>D*g.friction*e&&(E=D*g.friction*e*B);var F=y.cross(s,k),G=y.cross(t,k),H=n/(g.inverseMass+i.inverseInertia*F*F+j.inverseInertia*G*G);if(C*=H,E*=H,0>x&&x*x>a*e)q.normalImpulse=0,q.tangentImpulse=0;else{var I=q.normalImpulse;q.normalImpulse=Math.min(q.normalImpulse+C,0),C=q.normalImpulse-I;var J=q.tangentImpulse;q.tangentImpulse=o.clamp(q.tangentImpulse+E,-A,A),E=q.tangentImpulse-J}d.x=k.x*C+l.x*E,d.y=k.y*C+l.y*E,i.isStatic||i.isSleeping||(i.positionPrev.x+=d.x*i.inverseMass,i.positionPrev.y+=d.y*i.inverseMass,i.anglePrev+=y.cross(s,d)*i.inverseInertia),j.isStatic||j.isSleeping||(j.positionPrev.x-=d.x*j.inverseMass,j.positionPrev.y-=d.y*j.inverseMass,j.anglePrev-=y.cross(t,d)*j.inverseInertia)}}}}}();var l={};!function(){l.collides=function(b,d,e){var f,g,h,i,j=e,k=!1;if(j){var l=b.speed*b.speed+b.angularSpeed*b.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;k=j&&j.collided&&.2>l,i=j}else i={collided:!1,bodyA:b,bodyB:d};if(j&&k){var m=[j.bodyA.axes[j.axisNumber]];if(h=a(j.bodyA.vertices,j.bodyB.vertices,m),i.reused=!0,h.overlap<=0)return i.collided=!1,i}else{if(f=a(b.vertices,d.vertices,b.axes),f.overlap<=0)return i.collided=!1,i;if(g=a(d.vertices,b.vertices,d.axes),g.overlap<=0)return i.collided=!1,i;f.overlap<g.overlap?(h=f,i.bodyA=b,i.bodyB=d):(h=g,i.bodyA=d,i.bodyB=b),i.axisNumber=h.axisNumber}i.collided=!0,i.normal=h.axis,i.depth=h.overlap,b=i.bodyA,d=i.bodyB,y.dot(i.normal,y.sub(d.position,b.position))>0&&(i.normal=y.neg(i.normal)),i.tangent=y.perp(i.normal),i.penetration={x:i.normal.x*i.depth,y:i.normal.y*i.depth};var n=c(b,d,i.normal),o=[n[0]];if(z.contains(b.vertices,n[1]))o.push(n[1]);else{var p=c(d,b,y.neg(i.normal));z.contains(d.vertices,p[0])&&o.push(p[0]),o.length<2&&z.contains(d.vertices,p[1])&&o.push(p[1])}return i.supports=o,i.supportCorrected=y.sub(n[0],i.penetration),i};var a=function(a,c,d){for(var e,f,g={},h={},i={overlap:Number.MAX_VALUE},j=0;j<d.length;j++){if(f=d[j],b(g,a,f),b(h,c,f),e=g.min<h.min?g.max-h.min:h.max-g.min,0>=e)return i.overlap=e,i;e<i.overlap&&(i.overlap=e,i.axis=f,i.axisNumber=j)}return i},b=function(a,b,c){for(var d=y.dot(b[0],c),e=d,f=1;f<b.length;f+=1){var g=y.dot(b[f],c);g>e?e=g:d>g&&(d=g)}a.min=d,a.max=e},c=function(a,b,c){for(var d,e,f=Number.MAX_VALUE,g={x:0,y:0},h=b.vertices,i=a.position,j=h[0],k=h[1],l=0;l<h.length;l++)e=h[l],g.x=e.x-i.x,g.y=e.y-i.y,d=-y.dot(c,g),f>d&&(f=d,j=e);var m=j.index-1>=0?j.index-1:h.length-1;e=h[m],g.x=e.x-i.x,g.y=e.y-i.y,f=-y.dot(c,g),k=e;var n=(j.index+1)%h.length;return e=h[n],g.x=e.x-i.x,g.y=e.y-i.y,d=-y.dot(c,g),f>d&&(f=d,k=e),[j,k]}}();var m={};!function(){var a=1e-6,b=.001;m.create=function(b){var c=b;c.bodyA&&!c.pointA&&(c.pointA={x:0,y:0}),c.bodyB&&!c.pointB&&(c.pointB={x:0,y:0});var d=c.bodyA?y.add(c.bodyA.position,c.pointA):c.pointA,e=c.bodyB?y.add(c.bodyB.position,c.pointB):c.pointB,f=y.magnitude(y.sub(d,e));c.length=c.length||f||a;var g={visible:!0,lineWidth:2,strokeStyle:"#666"};return c.render=o.extend(g,c.render),c.id=c.id||o.nextId(),c.label=c.label||"Constraint",c.type="constraint",c.stiffness=c.stiffness||1,c.angularStiffness=c.angularStiffness||0,c.angleA=c.bodyA?c.bodyA.angle:c.angleA,c.angleB=c.bodyB?c.bodyB.angle:c.angleB,c},m.solveAll=function(a,b){for(var c=0;c<a.length;c++)m.solve(a[c],b)},m.solve=function(c,d){var e=c.bodyA,f=c.bodyB,g=c.pointA,h=c.pointB;e&&!e.isStatic&&(c.pointA=y.rotate(g,e.angle-c.angleA),c.angleA=e.angle),f&&!f.isStatic&&(c.pointB=y.rotate(h,f.angle-c.angleB),c.angleB=f.angle);var i=g,j=h;if(e&&(i=y.add(e.position,g)),f&&(j=y.add(f.position,h)),i&&j){var k=y.sub(i,j),l=y.magnitude(k);0===l&&(l=a);var m=(l-c.length)/l,n=y.div(k,l),p=y.mult(k,.5*m*c.stiffness*d*d);if(!(Math.abs(1-l/c.length)<b*d)){var q,r,s,u,v,w,x,z;e&&!e.isStatic?(s={x:i.x-e.position.x+p.x,y:i.y-e.position.y+p.y},e.velocity.x=e.position.x-e.positionPrev.x,e.velocity.y=e.position.y-e.positionPrev.y,e.angularVelocity=e.angle-e.anglePrev,q=y.add(e.velocity,y.mult(y.perp(s),e.angularVelocity)),v=y.dot(s,n),x=e.inverseMass+e.inverseInertia*v*v):(q={x:0,y:0},x=e?e.inverseMass:0),f&&!f.isStatic?(u={x:j.x-f.position.x-p.x,y:j.y-f.position.y-p.y},f.velocity.x=f.position.x-f.positionPrev.x,f.velocity.y=f.position.y-f.positionPrev.y,f.angularVelocity=f.angle-f.anglePrev,r=y.add(f.velocity,y.mult(y.perp(u),f.angularVelocity)),w=y.dot(u,n),z=f.inverseMass+f.inverseInertia*w*w):(r={x:0,y:0},z=f?f.inverseMass:0);var A=y.sub(r,q),B=y.dot(n,A)/(x+z);B>0&&(B=0);var C,D={x:n.x*B,y:n.y*B};e&&!e.isStatic&&(C=y.cross(s,D)*e.inverseInertia*(1-c.angularStiffness),t.set(e,!1),C=o.clamp(C,-.01,.01),e.constraintImpulse.x-=p.x,e.constraintImpulse.y-=p.y,e.constraintImpulse.angle+=C,e.position.x-=p.x,e.position.y-=p.y,e.angle+=C),f&&!f.isStatic&&(C=y.cross(u,D)*f.inverseInertia*(1-c.angularStiffness),t.set(f,!1),C=o.clamp(C,-.01,.01),f.constraintImpulse.x+=p.x,f.constraintImpulse.y+=p.y,f.constraintImpulse.angle-=C,f.position.x+=p.x,f.position.y+=p.y,f.angle-=C)}}},m.postSolveAll=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.constraintImpulse;z.translate(c.vertices,d),0!==d.angle&&(z.rotate(c.vertices,d.angle,c.position),w.rotate(c.axes,d.angle),d.angle=0),x.update(c.bounds,c.vertices),d.x=0,d.y=0}}}();var n={};!function(){n.create=function(a,b){var d=a.input.mouse,e=m.create({label:"Mouse Constraint",pointA:d.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),f={type:"mouseConstraint",mouse:d,dragBody:null,dragPoint:null,constraint:e},g=o.extend(f,b);return q.on(a,"tick",function(){var b=c.allBodies(a.world);n.update(g,b)}),g},n.update=function(a,b){var c=a.mouse,d=a.constraint;if(0===c.button){if(!d.bodyB)for(var e=0;e<b.length;e++){var f=b[e];x.contains(f.bounds,c.position)&&z.contains(f.vertices,c.position)&&(d.pointA=c.position,d.bodyB=f,d.pointB={x:c.position.x-f.position.x,y:c.position.y-f.position.y},d.angleB=f.angle,t.set(f,!1))}}else d.bodyB=null,d.pointB=null;d.bodyB&&(t.set(d.bodyB,!1),d.pointA=c.position)}}();var o={};!function(){o._nextId=0,o.extend=function(a,b){var c,d,e;"boolean"==typeof b?(c=2,e=b):(c=1,e=!0),d=Array.prototype.slice.call(arguments,c);for(var f=0;f<d.length;f++){var g=d[f];if(g)for(var h in g)e&&g[h]&&g[h].constructor===Object?a[h]&&a[h].constructor!==Object?a[h]=g[h]:(a[h]=a[h]||{},o.extend(a[h],e,g[h])):a[h]=g[h]}return a},o.clone=function(a,b){return o.extend({},b,a)},o.keys=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)b.push(c);return b},o.values=function(a){var b=[];if(Object.keys){for(var c=Object.keys(a),d=0;d<c.length;d++)b.push(a[c[d]]);return b}for(var e in a)b.push(a[e]);return b},o.shadeColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)},o.shuffle=function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},o.choose=function(a){return a[Math.floor(Math.random()*a.length)]},o.isElement=function(a){try{return a instanceof HTMLElement}catch(b){return"object"==typeof a&&1===a.nodeType&&"object"==typeof a.style&&"object"==typeof a.ownerDocument}},o.clamp=function(a,b,c){return b>a?b:a>c?c:a},o.sign=function(a){return 0>a?-1:1},o.now=function(){var a=window.performance;return a?(a.now=a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow,+a.now()):+new Date},o.random=function(a,b){return a+Math.random()*(b-a)},o.colorToNumber=function(a){return a=a.replace("#",""),3==a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},o.log=function(a,b){if(console&&console.log){var c;switch(b){case"warn":c="color: coral";break;case"error":c="color: red"}console.log("%c [Matter] "+b+": "+a,c)}},o.nextId=function(){return o._nextId++}}();var p={};!function(){var a=60,e=a,h=1e3/a,j=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(o.now())},h)};p.create=function(b,c){c=o.isElement(b)?c:b,b=o.isElement(b)?b:null;var e={enabled:!0,positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,timeScale:1,input:{},events:[],timing:{fps:a,timestamp:0,delta:h,correction:1,deltaMin:1e3/a,deltaMax:1e3/(.5*a),timeScale:1,isFixed:!1},render:{element:b,controller:A}},j=o.extend(e,c);return j.render=j.render.controller.create(j.render),j.world=d.create(j.world),j.pairs=i.create(),j.metrics=j.metrics||r.create(),j.input.mouse=j.input.mouse||s.create(j.render.canvas),j.broadphase=j.broadphase||{current:"grid",grid:{controller:g,instance:g.create(),detector:f.collisions},bruteForce:{detector:f.bruteForce}},j},p.run=function(a){var b,c=0,d=0,f=[],g=1;!function h(i){if(j(h),a.enabled){var k,m,o=a.timing,r={timestamp:i};q.trigger(a,"beforeTick",r),o.isFixed?k=o.delta:(k=i-b||o.delta,b=i,f.push(k),f=f.slice(-e),k=Math.min.apply(null,f),k=k<o.deltaMin?o.deltaMin:k,k=k>o.deltaMax?o.deltaMax:k,m=k/o.delta,o.delta=k),0!==g&&(m*=o.timeScale/g),0===o.timeScale&&(m=0),g=o.timeScale,d+=1,i-c>=1e3&&(o.fps=d*((i-c)/1e3),c=i,d=0),q.trigger(a,"tick",r),a.world.isModified&&a.render.controller.clear(a.render),p.update(a,k,m),n(a),l(a),p.render(a),q.trigger(a,"afterTick",r)}}()},p.update=function(a,d,e){e="undefined"!=typeof e?e:1;var f,g=a.world,h=a.timing,j=a.broadphase[a.broadphase.current],l=[];h.timestamp+=d*h.timeScale,h.correction=e;var n={timestamp:a.timing.timestamp};q.trigger(a,"beforeUpdate",n);var o=c.allBodies(g),p=c.allConstraints(g);for(r.reset(a.metrics),a.enableSleeping&&t.update(o),b.applyGravityAll(o,g.gravity),b.updateAll(o,d,h.timeScale,e,g.bounds),f=0;f<a.constraintIterations;f++)m.solveAll(p,h.timeScale);m.postSolveAll(o),j.controller?(g.isModified&&j.controller.clear(j.instance),j.controller.update(j.instance,o,a,g.isModified),l=j.instance.pairsList):l=o;var s=j.detector(l,a),u=a.pairs,v=h.timestamp;for(i.update(u,s,v),i.removeOld(u,v),a.enableSleeping&&t.afterCollisions(u.list),k.preSolveVelocity(u.list),f=0;f<a.velocityIterations;f++)k.solveVelocity(u.list,h.timeScale);for(f=0;f<a.positionIterations;f++)k.solvePosition(u.list,h.timeScale);return k.postSolvePosition(o),r.update(a.metrics,a),b.resetForcesAll(o),g.isModified&&c.setModified(g,!1,!1,!0),q.trigger(a,"afterUpdate",n),a},p.render=function(a){var b={timestamp:a.timing.timestamp};q.trigger(a,"beforeRender",b),a.render.controller.world(a),q.trigger(a,"afterRender",b)},p.merge=function(a,b){if(o.extend(a,b),b.world){a.world=b.world,p.clear(a);for(var d=c.allBodies(a.world),e=0;e<d.length;e++){var f=d[e];t.set(f,!1),f.id=o.nextId()}}},p.clear=function(a){var b=a.world;i.clear(a.pairs);var d=a.broadphase[a.broadphase.current];if(d.controller){var e=c.allBodies(b);d.controller.clear(d.instance),d.controller.update(d.instance,e,a,!0)}};var l=function(a){var b=a.input.mouse,c=b.sourceEvents;c.mousemove&&q.trigger(a,"mousemove",{mouse:b}),c.mousedown&&q.trigger(a,"mousedown",{mouse:b}),c.mouseup&&q.trigger(a,"mouseup",{mouse:b}),s.clearSourceEvents(b)},n=function(a){var b=a.pairs;b.collisionStart.length>0&&q.trigger(a,"collisionStart",{pairs:b.collisionStart}),b.collisionActive.length>0&&q.trigger(a,"collisionActive",{pairs:b.collisionActive}),b.collisionEnd.length>0&&q.trigger(a,"collisionEnd",{pairs:b.collisionEnd})}}();var q={};!function(){q.on=function(a,b,c){for(var d,e=b.split(" "),f=0;f<e.length;f++)d=e[f],a.events=a.events||{},a.events[d]=a.events[d]||[],a.events[d].push(c);return c},q.off=function(a,b,c){if(!b)return void(a.events={});"function"==typeof b&&(c=b,b=o.keys(a.events).join(" "));for(var d=b.split(" "),e=0;e<d.length;e++){var f=a.events[d[e]],g=[];if(c)for(var h=0;h<f.length;h++)f[h]!==c&&g.push(f[h]);a.events[d[e]]=g}},q.trigger=function(a,b,c){var d,e,f,g;if(a.events){c||(c={}),d=b.split(" ");for(var h=0;h<d.length;h++)if(e=d[h],f=a.events[e]){g=o.clone(c,!1),g.name=e,g.source=a;for(var i=0;i<f.length;i++)f[i].apply(a,[g])}}}}();var r={};!function(){r.create=function(){return{extended:!1,narrowDetections:0,narrowphaseTests:0,narrowReuse:0,narrowReuseCount:0,midphaseTests:0,broadphaseTests:0,narrowEff:1e-4,midEff:1e-4,broadEff:1e-4,collisions:0,buckets:0,bodies:0,pairs:0}},r.reset=function(a){a.extended&&(a.narrowDetections=0,a.narrowphaseTests=0,a.narrowReuse=0,a.narrowReuseCount=0,a.midphaseTests=0,a.broadphaseTests=0,a.narrowEff=0,a.midEff=0,a.broadEff=0,a.collisions=0,a.buckets=0,a.pairs=0,a.bodies=0)},r.update=function(a,b){if(a.extended){var d=b.world,e=(b.broadphase[b.broadphase.current],c.allBodies(d));a.collisions=a.narrowDetections,a.pairs=b.pairs.list.length,a.bodies=e.length,a.midEff=(a.narrowDetections/(a.midphaseTests||1)).toFixed(2),a.narrowEff=(a.narrowDetections/(a.narrowphaseTests||1)).toFixed(2),a.broadEff=(1-a.broadphaseTests/(e.length||1)).toFixed(2),a.narrowReuse=(a.narrowReuseCount/(a.narrowphaseTests||1)).toFixed(2)}}}();var s;!function(){s=function(b){var c=this;this.element=b||document.body,this.absolute={x:0,y:0},this.position={x:0,y:0},this.mousedownPosition={x:0,y:0},this.mouseupPosition={x:0,y:0},this.offset={x:0,y:0},this.scale={x:1,y:1},this.wheelDelta=0,this.button=-1,this.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},this.mousemove=function(b){var d=a(b,c.element),e=b.changedTouches;e&&(c.button=0,b.preventDefault()),c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.sourceEvents.mousemove=b},this.mousedown=function(b){var d=a(b,c.element),e=b.changedTouches;e?(c.button=0,b.preventDefault()):c.button=b.button,c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.mousedownPosition.x=c.position.x,c.mousedownPosition.y=c.position.y,c.sourceEvents.mousedown=b},this.mouseup=function(b){var d=a(b,c.element),e=b.changedTouches;e&&b.preventDefault(),c.button=-1,c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.mouseupPosition.x=c.position.x,c.mouseupPosition.y=c.position.y,c.sourceEvents.mouseup=b},this.mousewheel=function(a){c.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),a.preventDefault()},s.setElement(c,c.element)},s.create=function(a){return new s(a)},s.setElement=function(a,b){a.element=b,b.addEventListener("mousemove",a.mousemove),b.addEventListener("mousedown",a.mousedown),b.addEventListener("mouseup",a.mouseup),b.addEventListener("mousewheel",a.mousewheel),b.addEventListener("DOMMouseScroll",a.mousewheel),b.addEventListener("touchmove",a.mousemove),b.addEventListener("touchstart",a.mousedown),b.addEventListener("touchend",a.mouseup)},s.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},s.setOffset=function(a,b){a.offset.x=b.x,a.offset.y=b.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},s.setScale=function(a,b){a.scale.x=b.x,a.scale.y=b.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y};var a=function(a,b){var c,d,e=b.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,g=void 0!==window.pageXOffset?window.pageXOffset:f.scrollLeft,h=void 0!==window.pageYOffset?window.pageYOffset:f.scrollTop,i=a.changedTouches;return i?(c=i[0].pageX-e.left-g,d=i[0].pageY-e.top-h):(c=a.pageX-e.left-g,d=a.pageY-e.top-h),{x:c/(b.clientWidth/b.width),y:d/(b.clientHeight/b.height)}}}();var t={};!function(){var a=.18,b=.08,c=.9;t.update=function(a){for(var d=0;d<a.length;d++){var e=a[d],f=e.speed*e.speed+e.angularSpeed*e.angularSpeed;if(e.force.x>0||e.force.y>0)t.set(e,!1);else{var g=Math.min(e.motion,f),h=Math.max(e.motion,f);e.motion=c*g+(1-c)*h,e.sleepThreshold>0&&e.motion<b?(e.sleepCounter+=1,e.sleepCounter>=e.sleepThreshold&&t.set(e,!0)):e.sleepCounter>0&&(e.sleepCounter-=1)}}},t.afterCollisions=function(b){for(var c=0;c<b.length;c++){var d=b[c];if(d.isActive){var e=d.collision,f=e.bodyA,g=e.bodyB;if(!(f.isSleeping&&g.isSleeping||f.isStatic||g.isStatic)&&(f.isSleeping||g.isSleeping)){var h=f.isSleeping&&!f.isStatic?f:g,i=h===f?g:f;!h.isStatic&&i.motion>a&&t.set(h,!1)}}}},t.set=function(a,b){b?(a.isSleeping=!0,a.sleepCounter=a.sleepThreshold,a.positionImpulse.x=0,a.positionImpulse.y=0,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.speed=0,a.angularSpeed=0,a.motion=0):(a.isSleeping=!1,a.sleepCounter=0)}}();var u={};!function(){u.rectangle=function(a,c,d,e,f){f=f||{};var g={label:"Rectangle Body",position:{x:a,y:c},vertices:z.fromPath("L 0 0 L "+d+" 0 L "+d+" "+e+" L 0 "+e)};if(f.chamfer){var h=f.chamfer;g.vertices=z.chamfer(g.vertices,h.radius,h.quality,h.qualityMin,h.qualityMax),delete f.chamfer}return b.create(o.extend({},g,f))},u.trapezoid=function(a,c,d,e,f,g){g=g||{},f*=.5;var h=(1-2*f)*d,i=d*f,j=i+h,k=j+i,l={label:"Trapezoid Body",position:{x:a,y:c},vertices:z.fromPath("L 0 0 L "+i+" "+-e+" L "+j+" "+-e+" L "+k+" 0")};
if(g.chamfer){var m=g.chamfer;l.vertices=z.chamfer(l.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete g.chamfer}return b.create(o.extend({},l,g))},u.circle=function(a,b,c,d,e){d=d||{},d.label="Circle Body",e=e||25;var f=Math.ceil(Math.max(10,Math.min(e,c)));return f%2===1&&(f+=1),d.circleRadius=c,u.polygon(a,b,f,c,d)},u.polygon=function(a,c,d,e,f){if(f=f||{},3>d)return u.circle(a,c,e,f);for(var g=2*Math.PI/d,h="",i=.5*g,j=0;d>j;j+=1){var k=i+j*g,l=Math.cos(k)*e,m=Math.sin(k)*e;h+="L "+l.toFixed(3)+" "+m.toFixed(3)+" "}var n={label:"Polygon Body",position:{x:a,y:c},vertices:z.fromPath(h)};if(f.chamfer){var p=f.chamfer;n.vertices=z.chamfer(n.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete f.chamfer}return b.create(o.extend({},n,f))}}();var v={};!function(){v.stack=function(a,d,e,f,g,h,i){for(var j,k=c.create({label:"Stack"}),l=a,m=d,n=0,o=0;f>o;o++){for(var p=0,q=0;e>q;q++){var r=i(l,m,q,o,j,n);if(r){var s=r.bounds.max.y-r.bounds.min.y,t=r.bounds.max.x-r.bounds.min.x;s>p&&(p=s),b.translate(r,{x:.5*t,y:.5*s}),l=r.bounds.max.x+g,c.addBody(k,r),j=r,n+=1}}m+=p+h,l=a}return k},v.chain=function(a,b,d,e,f,g){for(var h=a.bodies,i=1;i<h.length;i++){var j=h[i-1],k=h[i],l=j.bounds.max.y-j.bounds.min.y,n=j.bounds.max.x-j.bounds.min.x,p=k.bounds.max.y-k.bounds.min.y,q=k.bounds.max.x-k.bounds.min.x,r={bodyA:j,pointA:{x:n*b,y:l*d},bodyB:k,pointB:{x:q*e,y:p*f}},s=o.extend(r,g);c.addConstraint(a,m.create(s))}return a.label+=" Chain",a},v.mesh=function(a,b,d,e,f){var g,h,i,j,k,l=a.bodies;for(g=0;d>g;g++){for(h=0;b>h;h++)h>0&&(i=l[h-1+g*b],j=l[h+g*b],c.addConstraint(a,m.create(o.extend({bodyA:i,bodyB:j},f))));for(h=0;b>h;h++)g>0&&(i=l[h+(g-1)*b],j=l[h+g*b],c.addConstraint(a,m.create(o.extend({bodyA:i,bodyB:j},f))),e&&h>0&&(k=l[h-1+(g-1)*b],c.addConstraint(a,m.create(o.extend({bodyA:k,bodyB:j},f)))),e&&b-1>h&&(k=l[h+1+(g-1)*b],c.addConstraint(a,m.create(o.extend({bodyA:k,bodyB:j},f)))))}return a.label+=" Mesh",a},v.pyramid=function(a,c,d,e,f,g,h){return v.stack(a,c,d,e,f,g,function(c,g,i,j,k,l){var m=Math.min(e,Math.ceil(d/2)),n=k?k.bounds.max.x-k.bounds.min.x:0;if(!(j>m)){j=m-j;var o=j,p=d-1-j;if(!(o>i||i>p)){1===l&&b.translate(k,{x:(i+(d%2===1?1:-1))*n,y:0});var q=k?i*n:0;return h(a+q+i*f,g,i,j,k,l)}}})},v.newtonsCradle=function(a,b,d,e,f){for(var g=c.create({label:"Newtons Cradle"}),h=0;d>h;h++){var i=1.9,j=u.circle(a+h*e*i,b+f,e,{inertia:99999,restitution:1,friction:0,frictionAir:1e-4,slop:.01}),k=m.create({pointA:{x:a+h*e*i,y:b},bodyB:j});c.addBody(g,j),c.addConstraint(g,k)}return g},v.car=function(a,d,e,f,g){var h=b.nextGroupId(),i=-20,j=.5*-e+i,k=.5*e-i,l=0,n=c.create({label:"Car"}),o=u.trapezoid(a,d,e,f,.3,{groupId:h,friction:.01,chamfer:{radius:10}}),p=u.circle(a+j,d+l,g,{groupId:h,restitution:.5,friction:.9,density:.01}),q=u.circle(a+k,d+l,g,{groupId:h,restitution:.5,friction:.9,density:.01}),r=m.create({bodyA:o,pointA:{x:j,y:l},bodyB:p,stiffness:.5}),s=m.create({bodyA:o,pointA:{x:k,y:l},bodyB:q,stiffness:.5});return c.addBody(n,o),c.addBody(n,p),c.addBody(n,q),c.addConstraint(n,r),c.addConstraint(n,s),n},v.softBody=function(a,b,c,d,e,f,g,h,i,j){i=o.extend({inertia:1/0},i),j=o.extend({stiffness:.4},j);var k=v.stack(a,b,c,d,e,f,function(a,b){return u.circle(a,b,h,i)});return v.mesh(k,c,d,g,j),k.label="Soft Body",k}}();var w={};!function(){w.fromVertices=function(a){for(var b={},c=0;c<a.length;c++){var d=(c+1)%a.length,e=y.normalise({x:a[d].y-a[c].y,y:a[c].x-a[d].x}),f=0===e.y?1/0:e.x/e.y;f=f.toFixed(3).toString(),b[f]=e}return o.values(b)},w.rotate=function(a,b){if(0!==b)for(var c=Math.cos(b),d=Math.sin(b),e=0;e<a.length;e++){var f,g=a[e];f=g.x*c-g.y*d,g.y=g.x*d+g.y*c,g.x=f}}}();var x={};!function(){x.create=function(a){var b={min:{x:0,y:0},max:{x:0,y:0}};return a&&x.update(b,a),b},x.update=function(a,b,c){a.min.x=Number.MAX_VALUE,a.max.x=Number.MIN_VALUE,a.min.y=Number.MAX_VALUE,a.max.y=Number.MIN_VALUE;for(var d=0;d<b.length;d++){var e=b[d];e.x>a.max.x&&(a.max.x=e.x),e.x<a.min.x&&(a.min.x=e.x),e.y>a.max.y&&(a.max.y=e.y),e.y<a.min.y&&(a.min.y=e.y)}c&&(c.x>0?a.max.x+=c.x:a.min.x+=c.x,c.y>0?a.max.y+=c.y:a.min.y+=c.y)},x.contains=function(a,b){return b.x>=a.min.x&&b.x<=a.max.x&&b.y>=a.min.y&&b.y<=a.max.y},x.overlaps=function(a,b){return a.min.x<=b.max.x&&a.max.x>=b.min.x&&a.max.y>=b.min.y&&a.min.y<=b.max.y},x.translate=function(a,b){a.min.x+=b.x,a.max.x+=b.x,a.min.y+=b.y,a.max.y+=b.y},x.shift=function(a,b){var c=a.max.x-a.min.x,d=a.max.y-a.min.y;a.min.x=b.x,a.max.x=b.x+c,a.min.y=b.y,a.max.y=b.y+d}}();var y={};!function(){y.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},y.magnitudeSquared=function(a){return a.x*a.x+a.y*a.y},y.rotate=function(a,b){var c=Math.cos(b),d=Math.sin(b);return{x:a.x*c-a.y*d,y:a.x*d+a.y*c}},y.rotateAbout=function(a,b,c){var d=Math.cos(b),e=Math.sin(b);return{x:c.x+((a.x-c.x)*d-(a.y-c.y)*e),y:c.y+((a.x-c.x)*e+(a.y-c.y)*d)}},y.normalise=function(a){var b=y.magnitude(a);return 0===b?{x:0,y:0}:{x:a.x/b,y:a.y/b}},y.dot=function(a,b){return a.x*b.x+a.y*b.y},y.cross=function(a,b){return a.x*b.y-a.y*b.x},y.add=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},y.sub=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},y.mult=function(a,b){return{x:a.x*b,y:a.y*b}},y.div=function(a,b){return{x:a.x/b,y:a.y/b}},y.perp=function(a,b){return b=b===!0?-1:1,{x:b*-a.y,y:b*a.x}},y.neg=function(a){return{x:-a.x,y:-a.y}},y.angle=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}}();var z={};!function(){z.create=function(a,b){for(var c=0;c<a.length;c++)a[c].index=c,a[c].body=b},z.fromPath=function(a){var b=/L\s*([\-\d\.]*)\s*([\-\d\.]*)/gi,c=[];return a.replace(b,function(a,b,d){c.push({x:parseFloat(b,10),y:parseFloat(d,10)})}),c},z.centre=function(a){for(var b,c,d,e=z.area(a,!0),f={x:0,y:0},g=0;g<a.length;g++)d=(g+1)%a.length,b=y.cross(a[g],a[d]),c=y.mult(y.add(a[g],a[d]),b),f=y.add(f,c);return y.div(f,6*e)},z.area=function(a,b){for(var c=0,d=a.length-1,e=0;e<a.length;e++)c+=(a[d].x-a[e].x)*(a[d].y+a[e].y),d=e;return b?c/2:Math.abs(c)/2},z.inertia=function(a,b){for(var c,d,e=0,f=0,g=a,h=0;h<g.length;h++)d=(h+1)%g.length,c=Math.abs(y.cross(g[d],g[h])),e+=c*(y.dot(g[d],g[d])+y.dot(g[d],g[h])+y.dot(g[h],g[h])),f+=c;return b/6*(e/f)},z.translate=function(a,b,c){var d;if(c)for(d=0;d<a.length;d++)a[d].x+=b.x*c,a[d].y+=b.y*c;else for(d=0;d<a.length;d++)a[d].x+=b.x,a[d].y+=b.y},z.rotate=function(a,b,c){if(0!==b)for(var d=Math.cos(b),e=Math.sin(b),f=0;f<a.length;f++){var g=a[f],h=g.x-c.x,i=g.y-c.y;g.x=c.x+(h*d-i*e),g.y=c.y+(h*e+i*d)}},z.contains=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=a[(c+1)%a.length];if((b.x-d.x)*(e.y-d.y)+(b.y-d.y)*(d.x-e.x)>0)return!1}return!0},z.scale=function(a,b,c,d){if(1===b&&1===c)return a;d=d||z.centre(a);for(var e,f,g=0;g<a.length;g++)e=a[g],f=y.sub(e,d),a[g].x=d.x+f.x*b,a[g].y=d.y+f.y*c;return a},z.chamfer=function(a,b,c,d,e){b=b||[8],b.length||(b=[b]),c="undefined"!=typeof c?c:-1,d=d||2,e=e||14;for(var f=(z.centre(a),[]),g=0;g<a.length;g++){var h=a[g-1>=0?g-1:a.length-1],i=a[g],j=a[(g+1)%a.length],k=b[g<b.length?g:b.length-1];if(0!==k){var l=y.normalise({x:i.y-h.y,y:h.x-i.x}),m=y.normalise({x:j.y-i.y,y:i.x-j.x}),n=Math.sqrt(2*Math.pow(k,2)),p=y.mult(o.clone(l),k),q=y.normalise(y.mult(y.add(l,m),.5)),r=y.sub(i,y.mult(q,n)),s=c;-1===c&&(s=1.75*Math.pow(k,.32)),s=o.clamp(s,d,e),s%2===1&&(s+=1);for(var t=Math.acos(y.dot(l,m)),u=t/s,v=0;s>v;v++)f.push(y.add(y.rotate(p,u*v),r))}else f.push(i)}return f}}();var A={};!function(){A.create=function(b){var c={controller:A,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},d=o.extend(c,b);return d.canvas=d.canvas||a(d.options.width,d.options.height),d.context=d.canvas.getContext("2d"),d.textures={},d.bounds=d.bounds||{min:{x:0,y:0},max:{x:d.options.width,y:d.options.height}},A.setBackground(d,d.options.background),o.isElement(d.element)?d.element.appendChild(d.canvas):o.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),d},A.clear=function(){},A.setBackground=function(a,b){if(a.currentBackground!==b){var c=b;/(jpg|gif|png)$/.test(b)&&(c="url("+b+")"),a.canvas.style.background=c,a.canvas.style.backgroundSize="contain",a.currentBackground=b}},A.world=function(a){var b,d=a.render,e=a.world,f=d.canvas,g=d.context,h=d.options,i=c.allBodies(e),j=c.allConstraints(e),k=[],l=[];h.wireframes?A.setBackground(d,h.wireframeBackground):A.setBackground(d,h.background),g.globalCompositeOperation="source-in",g.fillStyle="transparent",g.fillRect(0,0,f.width,f.height),g.globalCompositeOperation="source-over";var m=d.bounds.max.x-d.bounds.min.x,n=d.bounds.max.y-d.bounds.min.y,o=m/d.options.width,p=n/d.options.height;if(h.hasBounds){for(b=0;b<i.length;b++){var q=i[b];x.overlaps(q.bounds,d.bounds)&&k.push(q)}for(b=0;b<j.length;b++){var r=j[b],s=r.bodyA,t=r.bodyB,u=r.pointA,v=r.pointB;s&&(u=y.add(s.position,r.pointA)),t&&(v=y.add(t.position,r.pointB)),u&&v&&(x.contains(d.bounds,u)||x.contains(d.bounds,v))&&l.push(r)}g.scale(1/o,1/p),g.translate(-d.bounds.min.x,-d.bounds.min.y)}else l=j,k=i;!h.wireframes||a.enableSleeping&&h.showSleeping?A.bodies(a,k,g):A.bodyWireframes(a,k,g),h.showBounds&&A.bodyBounds(a,k,g),(h.showAxes||h.showAngleIndicator)&&A.bodyAxes(a,k,g),h.showPositions&&A.bodyPositions(a,k,g),h.showVelocity&&A.bodyVelocity(a,k,g),h.showIds&&A.bodyIds(a,k,g),h.showCollisions&&A.collisions(a,a.pairs.list,g),A.constraints(l,g),h.showBroadphase&&"grid"===a.broadphase.current&&A.grid(a,a.broadphase[a.broadphase.current].instance,g),h.showDebug&&A.debug(a,g),h.hasBounds&&g.setTransform(1,0,0,1,0,0)},A.debug=function(a,b){var d=b,e=a.world,f=a.render,h=f.options,i=c.allBodies(e),j="    ";if(a.timing.timestamp-(f.debugTimestamp||0)>=500){var k="";k+="fps: "+Math.round(a.timing.fps)+j,a.metrics.extended&&(k+="delta: "+a.timing.delta.toFixed(3)+j,k+="correction: "+a.timing.correction.toFixed(3)+j,k+="bodies: "+i.length+j,a.broadphase.controller===g&&(k+="buckets: "+a.metrics.buckets+j),k+="\n",k+="collisions: "+a.metrics.collisions+j,k+="pairs: "+a.pairs.list.length+j,k+="broad: "+a.metrics.broadEff+j,k+="mid: "+a.metrics.midEff+j,k+="narrow: "+a.metrics.narrowEff+j),f.debugString=k,f.debugTimestamp=a.timing.timestamp}if(f.debugString){d.font="12px Arial",d.fillStyle=h.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";for(var l=f.debugString.split("\n"),m=0;m<l.length;m++)d.fillText(l[m],50,50+18*m)}},A.constraints=function(a,b){for(var c=b,d=0;d<a.length;d++){var e=a[d];if(e.render.visible&&e.pointA&&e.pointB){var f=e.bodyA,g=e.bodyB;f?(c.beginPath(),c.moveTo(f.position.x+e.pointA.x,f.position.y+e.pointA.y)):(c.beginPath(),c.moveTo(e.pointA.x,e.pointA.y)),g?c.lineTo(g.position.x+e.pointB.x,g.position.y+e.pointB.y):c.lineTo(e.pointB.x,e.pointB.y),c.lineWidth=e.render.lineWidth,c.strokeStyle=e.render.strokeStyle,c.stroke()}}},A.bodyShadows=function(a,b,c){for(var d=c,e=a.render,f=(e.options,0);f<b.length;f++){var g=b[f];if(g.render.visible){if(g.circleRadius)d.beginPath(),d.arc(g.position.x,g.position.y,g.circleRadius,0,2*Math.PI),d.closePath();else{d.beginPath(),d.moveTo(g.vertices[0].x,g.vertices[0].y);for(var h=1;h<g.vertices.length;h++)d.lineTo(g.vertices[h].x,g.vertices[h].y);d.closePath()}var i=g.position.x-.5*e.options.width,j=g.position.y-.2*e.options.height,k=Math.abs(i)+Math.abs(j);d.shadowColor="rgba(0,0,0,0.15)",d.shadowOffsetX=.05*i,d.shadowOffsetY=.05*j,d.shadowBlur=1+12*Math.min(1,k/1e3),d.fill(),d.shadowColor=null,d.shadowOffsetX=null,d.shadowOffsetY=null,d.shadowBlur=null}}},A.bodies=function(a,c,d){var e,f=d,g=a.render,h=g.options;for(e=0;e<c.length;e++){var i=c[e];if(i.render.visible)if(i.render.sprite&&i.render.sprite.texture&&!h.wireframes){var j=i.render.sprite,k=b(g,j.texture);h.showSleeping&&i.isSleeping&&(f.globalAlpha=.5),f.translate(i.position.x,i.position.y),f.rotate(i.angle),f.drawImage(k,k.width*-.5*j.xScale,k.height*-.5*j.yScale,k.width*j.xScale,k.height*j.yScale),f.rotate(-i.angle),f.translate(-i.position.x,-i.position.y),h.showSleeping&&i.isSleeping&&(f.globalAlpha=1)}else{if(i.circleRadius)f.beginPath(),f.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{f.beginPath(),f.moveTo(i.vertices[0].x,i.vertices[0].y);for(var l=1;l<i.vertices.length;l++)f.lineTo(i.vertices[l].x,i.vertices[l].y);f.closePath()}h.wireframes?(f.lineWidth=1,f.strokeStyle="#bbb",h.showSleeping&&i.isSleeping&&(f.strokeStyle="rgba(255,255,255,0.2)"),f.stroke()):(f.fillStyle=h.showSleeping&&i.isSleeping?o.shadeColor(i.render.fillStyle,50):i.render.fillStyle,f.lineWidth=i.render.lineWidth,f.strokeStyle=i.render.strokeStyle,f.fill(),f.stroke())}}},A.bodyWireframes=function(a,b,c){var d,e,f=c;for(f.beginPath(),d=0;d<b.length;d++){var g=b[d];if(g.render.visible){for(f.moveTo(g.vertices[0].x,g.vertices[0].y),e=1;e<g.vertices.length;e++)f.lineTo(g.vertices[e].x,g.vertices[e].y);f.lineTo(g.vertices[0].x,g.vertices[0].y)}}f.lineWidth=1,f.strokeStyle="#bbb",f.stroke()},A.bodyBounds=function(a,b,c){var d=c,e=a.render,f=e.options;d.beginPath();for(var g=0;g<b.length;g++){var h=b[g];h.render.visible&&d.rect(h.bounds.min.x,h.bounds.min.y,h.bounds.max.x-h.bounds.min.x,h.bounds.max.y-h.bounds.min.y)}d.strokeStyle=f.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)",d.lineWidth=1,d.stroke()},A.bodyAxes=function(a,b,c){var d,e,f=c,g=a.render,h=g.options;for(f.beginPath(),d=0;d<b.length;d++){var i=b[d];if(i.render.visible)if(h.showAxes)for(e=0;e<i.axes.length;e++){var j=i.axes[e];f.moveTo(i.position.x,i.position.y),f.lineTo(i.position.x+20*j.x,i.position.y+20*j.y)}else f.moveTo(i.position.x,i.position.y),f.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}f.strokeStyle=h.wireframes?"indianred":"rgba(0,0,0,0.3)",f.lineWidth=1,f.stroke()},A.bodyPositions=function(a,b,c){var d,e,f=c,g=a.render,h=g.options;for(f.beginPath(),e=0;e<b.length;e++)d=b[e],d.render.visible&&(f.arc(d.position.x,d.position.y,3,0,2*Math.PI,!1),f.closePath());for(f.fillStyle=h.wireframes?"indianred":"rgba(0,0,0,0.5)",f.fill(),f.beginPath(),e=0;e<b.length;e++)d=b[e],d.render.visible&&(f.arc(d.positionPrev.x,d.positionPrev.y,2,0,2*Math.PI,!1),f.closePath());f.fillStyle="rgba(255,165,0,0.8)",f.fill()},A.bodyVelocity=function(a,b,c){{var d=c,e=a.render;e.options}d.beginPath();for(var f=0;f<b.length;f++){var g=b[f];g.render.visible&&(d.moveTo(g.position.x,g.position.y),d.lineTo(g.position.x+2*(g.position.x-g.positionPrev.x),g.position.y+2*(g.position.y-g.positionPrev.y)))}d.lineWidth=3,d.strokeStyle="cornflowerblue",d.stroke()},A.bodyIds=function(a,b,c){for(var d=c,e=0;e<b.length;e++){var f=b[e];f.render.visible&&(d.font="12px Arial",d.fillStyle="rgba(255,255,255,0.5)",d.fillText(f.id,f.position.x+10,f.position.y-10))}},A.collisions=function(a,b,c){var d,e,f,g,h=c,i=a.render.options;for(h.beginPath(),f=0;f<b.length;f++)for(d=b[f],e=d.collision,g=0;g<d.activeContacts.length;g++){var j=d.activeContacts[g],k=j.vertex;h.rect(k.x-1.5,k.y-1.5,3.5,3.5)}for(h.fillStyle=i.wireframes?"rgba(255,255,255,0.7)":"orange",h.fill(),h.beginPath(),f=0;f<b.length;f++)if(d=b[f],e=d.collision,d.activeContacts.length>0){var l=d.activeContacts[0].vertex.x,m=d.activeContacts[0].vertex.y;2===d.activeContacts.length&&(l=(d.activeContacts[0].vertex.x+d.activeContacts[1].vertex.x)/2,m=(d.activeContacts[0].vertex.y+d.activeContacts[1].vertex.y)/2),h.moveTo(l-8*e.normal.x,m-8*e.normal.y),h.lineTo(l,m)}h.strokeStyle=i.wireframes?"rgba(255,165,0,0.7)":"orange",h.lineWidth=1,h.stroke()},A.grid=function(a,b,c){var d=c,e=a.render.options;d.strokeStyle=e.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)",d.beginPath();for(var f=o.keys(b.buckets),g=0;g<f.length;g++){var h=f[g];if(!(b.buckets[h].length<2)){var i=h.split(",");d.rect(.5+parseInt(i[0],10)*b.bucketWidth,.5+parseInt(i[1],10)*b.bucketHeight,b.bucketWidth,b.bucketHeight)}}d.lineWidth=1,d.stroke()},A.inspector=function(a,b){var c,d=a.engine,e=(d.input.mouse,a.selected),f=d.render,g=f.options;if(g.hasBounds){var h=f.bounds.max.x-f.bounds.min.x,i=f.bounds.max.y-f.bounds.min.y,j=h/f.options.width,k=i/f.options.height;b.scale(1/j,1/k),b.translate(-f.bounds.min.x,-f.bounds.min.y)}for(var l=0;l<e.length;l++){var m=e[l].data;switch(b.translate(.5,.5),b.lineWidth=1,b.strokeStyle="rgba(255,165,0,0.9)",b.setLineDash([1,2]),m.type){case"body":c=m.bounds,b.beginPath(),b.rect(Math.floor(c.min.x-3),Math.floor(c.min.y-3),Math.floor(c.max.x-c.min.x+6),Math.floor(c.max.y-c.min.y+6)),b.closePath(),b.stroke();break;case"constraint":var n=m.pointA;m.bodyA&&(n=m.pointB),b.beginPath(),b.arc(n.x,n.y,10,0,2*Math.PI),b.closePath(),b.stroke()}b.setLineDash([0]),b.translate(-.5,-.5)}null!==a.selectStart&&(b.translate(.5,.5),b.lineWidth=1,b.strokeStyle="rgba(255,165,0,0.6)",b.fillStyle="rgba(255,165,0,0.1)",c=a.selectBounds,b.beginPath(),b.rect(Math.floor(c.min.x),Math.floor(c.min.y),Math.floor(c.max.x-c.min.x),Math.floor(c.max.y-c.min.y)),b.closePath(),b.stroke(),b.fill(),b.translate(-.5,-.5)),g.hasBounds&&b.setTransform(1,0,0,1,0,0)};var a=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.oncontextmenu=function(){return!1},c.onselectstart=function(){return!1},c},b=function(a,b){var c=a.textures[b];return c?c:(c=a.textures[b]=new Image,c.src=b,c)}}();var B={};!function(){B.create=function(a){var b={controller:B,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},c=o.extend(b,a);return c.context=new PIXI.WebGLRenderer(800,600,c.canvas,!1,!0),c.canvas=c.context.view,c.stage=new PIXI.Stage,c.textures={},c.sprites={},c.primitives={},c.spriteBatch=new PIXI.SpriteBatch,c.stage.addChild(c.spriteBatch),o.isElement(c.element)?c.element.appendChild(c.canvas):o.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),c.canvas.oncontextmenu=function(){return!1},c.canvas.onselectstart=function(){return!1},c},B.clear=function(a){for(var b=a.stage,c=a.spriteBatch;b.children[0];)b.removeChild(b.children[0]);for(;c.children[0];)c.removeChild(c.children[0]);var d=a.sprites["bg-0"];a.textures={},a.sprites={},a.primitives={},a.sprites["bg-0"]=d,d&&c.addChildAt(d,0),a.stage.addChild(a.spriteBatch),a.currentBackground=null},B.setBackground=function(a,b){if(a.currentBackground!==b){var c=b.indexOf&&-1!==b.indexOf("#"),e=a.sprites["bg-0"];if(c){var f=o.colorToNumber(b);a.stage.setBackgroundColor(f),e&&a.spriteBatch.removeChild(e)}else if(!e){var g=d(a,b);e=a.sprites["bg-0"]=new PIXI.Sprite(g),e.position.x=0,e.position.y=0,a.spriteBatch.addChildAt(e,0)}a.currentBackground=b}},B.world=function(a){var b,d=a.render,e=a.world,f=d.context,g=d.stage,h=d.options,i=c.allBodies(e),j=c.allConstraints(e);for(h.wireframes?B.setBackground(d,h.wireframeBackground):B.setBackground(d,h.background),b=0;b<i.length;b++)B.body(a,i[b]);for(b=0;b<j.length;b++)B.constraint(a,j[b]);f.render(g)},B.constraint=function(a,b){var c=a.render,d=b.bodyA,e=b.bodyB,f=b.pointA,g=b.pointB,h=c.stage,i=b.render,j="c-"+b.id,k=c.primitives[j];return k||(k=c.primitives[j]=new PIXI.Graphics),i.visible&&b.pointA&&b.pointB?(-1===h.children.indexOf(k)&&h.addChild(k),k.clear(),k.beginFill(0,0),k.lineStyle(i.lineWidth,o.colorToNumber(i.strokeStyle),1),d?k.moveTo(d.position.x+f.x,d.position.y+f.y):k.moveTo(f.x,f.y),e?k.lineTo(e.position.x+g.x,e.position.y+g.y):k.lineTo(g.x,g.y),void k.endFill()):void k.clear()},B.body=function(c,d){var e=c.render,f=d.render;if(f.visible)if(f.sprite&&f.sprite.texture){var g="b-"+d.id,h=e.sprites[g],i=e.spriteBatch;h||(h=e.sprites[g]=a(e,d)),-1===i.children.indexOf(h)&&i.addChild(h),h.position.x=d.position.x,h.position.y=d.position.y,h.rotation=d.angle}else{var j="b-"+d.id,k=e.primitives[j],l=e.stage;k||(k=e.primitives[j]=b(e,d),k.initialAngle=d.angle),-1===l.children.indexOf(k)&&l.addChild(k),k.position.x=d.position.x,k.position.y=d.position.y,k.rotation=d.angle-k.initialAngle}};var a=function(a,b){var c=b.render,e=c.sprite.texture,f=d(a,e),g=new PIXI.Sprite(f);return g.anchor.x=.5,g.anchor.y=.5,g},b=function(a,b){var c=b.render,d=a.options,e=new PIXI.Graphics;e.clear(),d.wireframes?(e.beginFill(0,0),e.lineStyle(1,o.colorToNumber("#bbb"),1)):(e.beginFill(o.colorToNumber(c.fillStyle),1),e.lineStyle(b.render.lineWidth,o.colorToNumber(c.strokeStyle),1)),e.moveTo(b.vertices[0].x-b.position.x,b.vertices[0].y-b.position.y);for(var f=1;f<b.vertices.length;f++)e.lineTo(b.vertices[f].x-b.position.x,b.vertices[f].y-b.position.y);return e.lineTo(b.vertices[0].x-b.position.x,b.vertices[0].y-b.position.y),e.endFill(),(d.showAngleIndicator||d.showAxes)&&(e.beginFill(0,0),d.wireframes?e.lineStyle(1,o.colorToNumber("#CD5C5C"),1):e.lineStyle(1,o.colorToNumber(b.render.strokeStyle)),e.moveTo(0,0),e.lineTo((b.vertices[0].x+b.vertices[b.vertices.length-1].x)/2-b.position.x,(b.vertices[0].y+b.vertices[b.vertices.length-1].y)/2-b.position.y),e.endFill()),e},d=function(a,b){var c=a.textures[b];return c||(c=a.textures[b]=PIXI.Texture.fromImage(b)),c}}(),d.add=c.add,d.remove=c.remove,d.addComposite=c.addComposite,d.addBody=c.addBody,d.addConstraint=c.addConstraint,d.clear=c.clear,a.Body=b,a.Composite=c,a.World=d,a.Contact=e,a.Detector=f,a.Grid=g,a.Pairs=i,a.Pair=h,a.Resolver=k,a.SAT=l,a.Constraint=m,a.MouseConstraint=n,a.Common=o,a.Engine=p,a.Metrics=r,a.Mouse=s,a.Sleeping=t,a.Bodies=u,a.Composites=v,a.Axes=w,a.Bounds=x,a.Vector=y,a.Vertices=z,a.Render=A,a.RenderPixi=B,a.Events=q,a.Query=j,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.Matter=a),"function"==typeof define&&define.amd&&define("Matter",[],function(){return a}),"object"==typeof window&&"object"==typeof window.document&&(window.Matter=a)}();
},{}],2:[function(require,module,exports){
/*!
 * oCanvas v2.7.3
 * http://ocanvas.org/
 *
 * Copyright 2011-2014, Johannes Koggdal
 * Licensed under the MIT license
 * http://ocanvas.org/license
 *
 * Including Xccessors by Eli Grey
 * Including easing equations by Robert Penner
 */
(function(a,b,c){var d={version:"2.7.3",canvasList:[],modules:{},inits:{},plugins:{},core:function(a){this.isCore=!0,this.id=d.canvasList.push(this)-1,this.lastObjectID=0,this.children=[],this.domEventHandlers=[];for(var c in d.modules)typeof d.modules[c]=="function"?this[c]=d.modules[c]():this[c]=Object.create(d.modules[c]);this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},d.extend(this.settings,a),this.originalSettings=d.extend({},this.settings);if(this.settings.canvas.nodeName&&this.settings.canvas.nodeName.toLowerCase()==="canvas")this.canvasElement=this.settings.canvas;else if(typeof this.settings.canvas=="string")this.canvasElement=b.querySelector(this.settings.canvas);else return!1;this.canvas=this.canvasElement.getContext("2d");var e=this.canvasElement.width,f=this.canvasElement.height;Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,set:function(a){e=isNaN(parseFloat(a))?e:parseFloat(a),this.canvasElement.width=e,this.background.set(this.settings.background),this.redraw()},get:function(){return e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,set:function(a){f=isNaN(parseFloat(a))?f:parseFloat(a),this.canvasElement.height=f,this.background.set(this.settings.background),this.redraw()},get:function(){return f}});for(var c in d.modules){if(this[c].wrapper===!0)for(var g in this[c])typeof this[c][g]=="object"&&typeof this[c][g].setCore=="function"?this[c][g]=this[c][g].setCore(this):typeof this[c][g].setCore=="function"&&this[c][g].setCore(this),this[c].core=this;this[c].core=this}for(var h in d.inits)if(typeof d.inits[h]=="string"&&typeof this[h][d.inits[h]]=="function")this[h][d.inits[h]]();else if(d.inits[h]==="object")for(var i in d.inits[h])typeof this[h][d.inits[h][i]]=="function"&&this[h][d.inits[h][i]]();var j=this.settings.plugins;if(j.length>0)for(var k=0,l=j.length;k<l;k++)typeof d.plugins[j[k]]=="function"&&d.plugins[j[k]].call(this)},registerModule:function(a,b,e){if(~a.indexOf(".")){var f=a.split(".");d.modules[f[0]][f[1]]=b,e!==c&&(d.inits[f[0]]||(d.inits[f[0]]={}),d.inits[f[0]][f[1]]=e)}else d.modules[a]=b,e!==c&&(d.inits[a]=e)},registerPlugin:function(a,b){d.plugins[a]=b},create:function(a){return new d.core(a)},domReady:function(a){a=a||function(){},this.domReadyHandlers.push(a);if(this.isDomReadyListening)return!1;if(this.isDomReady){d.triggerDomReadyHandlers();return!0}var c=function(a){if(b.readyState==="complete"||a&&a.type==="DOMContentLoaded")d.isDomReadyListening=!1,d.isDomReady=!0,d.triggerDomReadyHandlers(),b.removeEventListener("readystatechange",c,!1),b.removeEventListener("DOMContentLoaded",c,!1)};if(c())return!0;if(!this.isDomReadyListening){d.isDomReadyListening=!0,b.addEventListener("readystatechange",c,!1),b.addEventListener("DOMContentLoaded",c,!1);return!1}},isDomReady:!1,isDomReadyListening:!1,domReadyHandlers:[],triggerDomReadyHandlers:function(){var a,b,c,d;a=this.domReadyHandlers;for(b=0,c=a.length;b<c;b++)d=a[b],d&&(delete a[b],d())}};d.core.prototype={addChild:function(a,b){a.add(b);return this},removeChild:function(a,b){a.remove(b);return this},clear:function(a){this.draw.clear(a);return this},redraw:function(){this.draw.redraw();return this},bind:function(a,b){this.events.bind(this.canvasElement,a.split(" "),b);return this},unbind:function(a,b){this.events.unbind(this.canvasElement,a.split(" "),b);return this},trigger:function(a,b){var c=this.events;c.triggerHandlers(this.canvasElement,a.split(" "),c.fixEventObject(b));return this},reset:function(){var a=this.children;for(var b=0,c=a.length;b<c;b++)a[b].remove(),b--,c--;a.length=0,this.lastObjectID=0;var e=this.canvasElement.events;for(var f in e)e[f]instanceof Array&&this.unbind(f,e[f]);this.settings=d.extend({},this.originalSettings)},destroy:function(){this.reset();for(var a=0,b=this.domEventHandlers.length;a<b;a++)d.removeDOMEventHandler(this,a);this.domEventHandlers.length=0,d.canvasList[this.id]=null}},a.oCanvas=d,d.domReady(),d.extend=function(){var a=Array.prototype.slice.call(arguments),b=a[a.length-1],c=a.splice(0,1)[0],e=a.splice(0,1)[0],f,g=[],h;b.exclude&&JSON.stringify(b)===JSON.stringify({exclude:b.exclude})&&(g=b.exclude);if(e!==b||g.length===0)for(f in e){if(~g.indexOf(f))continue;h=Object.getOwnPropertyDescriptor(e,f),h.get||h.set?Object.defineProperty(c,f,h):c[f]=e[f]}return a.length>0?d.extend.apply(this,[c].concat(a)):c},d.addDOMEventHandler=function(a,b,c,d,e){a.domEventHandlers.push({obj:b,event:c,handler:d,useCapture:!!e}),b.addEventListener(c,d,e)},d.removeDOMEventHandler=function(a,b){var c=a.domEventHandlers[b];c.obj.removeEventListener(c.event,c.handler,c.useCapture)},d.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},typeof Object.create!="function"&&(Object.create=function(a){function b(){}b.prototype=a;return new b}),typeof Object.getPropertyDescriptor!="function"&&(Object.getPropertyDescriptor=function(a,b){var d=Object.getOwnPropertyDescriptor(a,b),e=Object.getPrototypeOf(a);while(d===c&&e!==null)d=Object.getOwnPropertyDescriptor(e,b),e=Object.getPrototypeOf(e);return d}),function(){var b=0,c=["ms","moz","webkit","o"];for(var d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-b)),g=a.setTimeout(function(){c(e+f)},f);b=e+f;return g}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(),a.log=function(){log.history=log.history||[],log.history.push(arguments);if(this.console){var a,b=Array.prototype.slice.call(arguments),c=b.length;for(a=0;a<c;a++)console.log(b[a])}};var e=function(){var a={init:function(){var a=this;this.core.setLoop=function(b){a.userLoop=b;return a}},currentFrame:1,timeline:0,running:!1,set fps(a){this.core.settings.fps=a,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){!this.running||setTimeout(function(){a.timeline=requestAnimationFrame(a.loopBound);var b=a.core;typeof a.userLoop=="function"&&(b.settings.clearEachFrame===!0&&b.draw.clear(),a.userLoop.call(b,b.canvas),b.settings.drawEachFrame===!0&&b.draw.redraw(),a.currentFrame++)},1e3/a.fps)},loopBound:function(){a.loop()},start:function(){cancelAnimationFrame(a.timeline),a.running=!0,a.loop();return this},stop:function(){this.running=!1,cancelAnimationFrame(a.timeline);return this}};return a};d.registerModule("timeline",e,"init");var f=function(){return{keysDown:{},keyPressTimers:{},modifiedKeys:[],init:function(){var a=this;d.addDOMEventHandler(this.core,b,"keydown",function(b){a.docHandler(b)},!1),d.addDOMEventHandler(this.core,b,"keyup",function(b){a.docHandler(b)},!1),d.addDOMEventHandler(this.core,b,"keypress",function(b){a.preventDefault(b)},!1)},docHandler:function(a){var b,c,d,e;c=this.core.events,d=this.core.canvasElement;if(!!c.enabled){if(this.core.pointer&&this.core.pointer.canvasFocused!==!0)return;b=this.getKeyCode(a),this.preventDefault(a);if(a.type==="keydown"&&this.keysDown[b]===!0)return;a.type==="keydown"?this.keysDown[b]=!0:a.type==="keyup"&&delete this.keysDown[b],e=c.fixEventObject(a,"keyboard"),c.lastKeyboardEventObject=e,c.triggerHandlers(d,[a.type]),a.type==="keydown"&&(this.keyPressTimers[b]=setInterval(function(){c.triggerHandlers(d,["keypress"],e)},1e3/this.core.settings.fps));if(a.type==="keyup")if(!this.anyKeysDown())for(b in this.keyPressTimers)clearInterval(this.keyPressTimers[b]);else clearInterval(this.keyPressTimers[b])}},preventDefault:function(a){if(this.core.mouse&&this.core.mouse.canvasFocused===!0||!this.core.mouse){var b=this.getKeyCode(a);~this.modifiedKeys.indexOf(b)&&a.preventDefault()}},addPreventDefaultFor:function(a){a=typeof a=="number"?[a]:a instanceof Array?a:[];for(var b=0;b<a.length;b++)this.modifiedKeys.push(a[b])},removePreventDefaultFor:function(a){a=typeof a=="number"?[a]:a instanceof Array?a:[];var b,c;for(b=0;b<a.length;b++)c=this.modifiedKeys.indexOf(a[b]),~c&&this.modifiedKeys.splice(c,1)},getKeyCode:function(a){return a.keyCode===0?a.which:a.keyCode},numKeysDown:function(){var a,b,c;a=0,b=this.keysDown;for(c in b)b[c]===!0&&a++;return a},anyKeysDown:function(){return this.numKeysDown()>0},getKeysDown:function(){var a,b,c;a=this.keysDown,b=[];for(c in a)a[c]===!0&&b.push(parseInt(c,10));return b},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}};d.registerModule("keyboard",f,"init");var g=function(){return{x:0,y:0,buttonState:"up",canvasFocused:!1,canvasHovered:!1,cursorValue:"default",init:function(){this.core.events.addEventTypes("mouse",{move:"mousemove",enter:"mouseenter",leave:"mouseleave",down:"mousedown",up:"mouseup",singleClick:"click",doubleClick:"dblclick"}),this.types={mousemove:"move",mousedown:"down",mouseup:"up",dblclick:"doubleClick"},this.core.pointer=this,(!this.core.touch||!this.core.touch.isTouch)&&this.bindHandlers()},bindHandlers:function(){var c,e,f,g;c=this,e=this.core,f=e.canvasElement;for(g in this.types){d.addDOMEventHandler(e,f,g,function(a){c.canvasHandler(a)},!1),g==="mousemove"&&(g="mouseover"),d.addDOMEventHandler(e,b,g,function(a){c.docHandler(a)},!1);var h=b.createElement("a");h.href=b.referrer,h.host===a.location.host&&a.parent!==a&&d.addDOMEventHandler(e,a.parent.document,g,function(a){c.docHandler(a)},!1)}},canvasHandler:function(a,b){var d,e,f,g;d=this.core.events,e=this.onCanvas(a);if(a.type==="mouseup"&&!e&&!this.canvasUpEventTriggered)d.triggerPointerEvent(this.types.mouseup,d.frontObject,"mouse",a),d.triggerPointerEvent(this.types.mouseup,this.core.canvasElement,"mouse",a),this.canvasUpEventTriggered=!0;else{if(!b&&!e)return;f=b&&a.type==="mouseover"?"mousemove":a.type,b||(this.canvasHovered=!0),f==="mousedown"&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.buttonState="down"),f==="mouseup"&&(this.buttonState="up"),g=b||!e?c:d.getFrontObject("mouse"),b&&d.frontObject?(d.triggerChain(d.getParentChain(d.frontObject,!0,!0),["mouseleave"]),d.frontObject=null):b?d.triggerHandlers(this.core.canvasElement,["mouseleave"]):d.triggerPointerEvent(this.types[f],g,"mouse",a)}},docHandler:function(a){var b=this.onCanvas(a);b||(this.core.canvasElement.events.hasEntered?a.type==="mouseover"&&this.canvasHandler(a,!0):(a.type==="mouseup"&&this.buttonState==="down"&&this.canvasHandler(a,!0),a.type==="mousedown"&&(this.canvasFocused=!1)))},getPos:function(b){var c=this.core.canvasElement,d=c.getBoundingClientRect(),e=c.width/c.clientWidth,f=c.height/c.clientHeight,g=b.pageX-a.pageXOffset,h=b.pageY-a.pageYOffset,i=e*(g-Math.round(d.left)),j=f*(h-Math.round(d.top));return{x:i,y:j}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y},onCanvas:function(a){a=a||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,a&&this.updatePos(a);return!0}this.canvasHovered=!1;return!1},cancel:function(){this.core.events.lastDownObject=null},hide:function(){this.core.canvasElement.style.cursor="none"},show:function(){this.core.canvasElement.style.cursor=this.cursorValue},cursor:function(a){if(~a.indexOf("url(")){var b=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(a),c=b[5]?b[5]:"";a="url("+b[1]+") "+(b[3]?b[3]:0)+" "+(b[4]?b[4]:0)+(c!==""?c:", default")}this.core.canvasElement.style.cursor=a,this.cursorValue=a}}};d.registerModule("mouse",g,"init");var h=function(){return{x:0,y:0,touchState:"up",canvasFocused:!1,canvasHovered:!1,isTouch:"ontouchstart"in a||"createTouch"in b,dblTapInterval:500,init:function(){var a,b;a=this.core,b=a.canvasElement,a.events.addEventTypes("touch",{move:"touchmove",enter:"touchenter",leave:"touchleave",down:"touchstart",up:"touchend",singleClick:"tap",doubleClick:"dbltap"}),this.types={touchmove:"move",touchstart:"down",touchend:"up"},this.isTouch&&(a.pointer=this,b.style.WebkitUserSelect="none",b.style.WebkitTouchCallout="none",b.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.bindHandlers()},bindHandlers:function(){var c,e,f,g;c=this,e=this.core,f=e.canvasElement;for(g in this.types){d.addDOMEventHandler(e,f,g,function(a){c.canvasHandler(a)},!1),d.addDOMEventHandler(e,b,g,function(a){c.docHandler(a)},!1);var h=b.createElement("a");h.href=b.referrer,h.host===a.location.host&&a.parent!==a&&d.addDOMEventHandler(e,a.parent.document,g,function(a){c.docHandler(a)},!1)}this.core.settings.disableScrolling&&d.addDOMEventHandler(e,f,"touchmove",function(a){a.preventDefault()},!1)},canvasHandler:function(a,b){var d,e,f,g,h,i;d=this.core.events,e=this.onCanvas(a);if(a.type==="touchend"&&!e&&!this.canvasUpEventTriggered)d.triggerPointerEvent(this.types.touchend,d.frontObject,"touch",a),d.triggerPointerEvent(this.types.touchend,this.core.canvasElement,"touch",a),this.canvasUpEventTriggered=!0;else{if(!b&&!e)return;b||(this.canvasHovered=!0),a.type==="touchstart"&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.touchState="down"),a.type==="touchend"&&(this.touchState="up"),f=b||!e?c:d.getFrontObject("touch"),b&&d.frontObject?(d.triggerChain(d.getParentChain(d.frontObject,!0,!0),["touchleave"]),d.frontObject=null):b?d.triggerHandlers(this.core.canvasElement,["touchleave"]):d.triggerPointerEvent(this.types[a.type],f,"touch",a),a.type==="touchstart"&&(g=(new Date).getTime(),!this.dblTapStart||g-this.dblTapStart.timestamp>this.dblTapInterval?this.dblTapStart={timestamp:g,obj:f,count:1}:this.dblTapStart.count++),a.type==="touchend"&&this.dblTapStart.count===2&&(g=(new Date).getTime(),h=f===this.dblTapStart.obj,i=g-this.dblTapStart.timestamp,h&&i<this.dblTapInterval&&d.triggerPointerEvent("doubleClick",f,"touch",a),delete this.dblTapStart)}},docHandler:function(a){var b=this.onCanvas(a);b||(this.core.canvasElement.events.hasEntered?a.type==="touchmove"&&this.canvasHandler(a,!0):(a.type==="touchend"&&this.touchState==="down"&&this.canvasHandler(a,!0),a.type==="touchstart"&&(this.canvasFocused=!1)))},getPos:function(b){var d,e,f=b.changedTouches;if(f!==c&&f.length>0){b=f[0];var g=this.core.canvasElement,h=g.getBoundingClientRect(),i=g.width/g.clientWidth,j=g.height/g.clientHeight,k=b.pageX-a.pageXOffset,l=b.pageY-a.pageYOffset;d=i*(k-Math.round(h.left)),e=j*(l-Math.round(h.top))}else d=this.x,e=this.y;return{x:d,y:e}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y},onCanvas:function(a){a=a||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,a&&this.updatePos(a);return!0}this.canvasHovered=!1;return!1},cancel:function(){this.core.events.lastDownObject=null}}};d.registerModule("touch",h,"init");var i=function(){return{transformPointerPosition:function(a,b,c,d,e){d=d||0,e=e||this.core.pointer;if(typeof a=="object"){var f=a.parent,g=[],h={x:0,y:0},i,j,k,l,m;g.push(a);while(f&&f!==this.core)g.push(f),f=f.parent;g.reverse(),i=e;for(k=0,l=g.length;k<l;k++)j=g[k],h=this.transformPointerPosition(j.rotation,j.abs_x,j.abs_y,0,i),i=h;d!==0&&(m=a.getOrigin(),h=this.transformPointerPosition(d*-1,b-m.x,c-m.y,0,i));return{x:h.x,y:h.y}}var n=a,o=e.x>=b&&e.y<=c,p=e.x>=b&&e.y>=c,q=e.x<=b&&e.y>=c,r=e.x<=b&&e.y<=c,s=Math.sqrt(Math.pow(e.x-b,2)+Math.pow(e.y-c,2)),n=(n/360-Math.floor(n/360))*360-d,t,u,v,w=s===0?0:Math.abs(e.y-c)/s;if(o||q)t=(180-n-Math.asin(w)*180/Math.PI)*Math.PI/180,u=b+Math.cos(t)*s*(o?-1:1),v=c+Math.sin(t)*s*(o?-1:1);else if(r||p)t=(Math.asin(w)*180/Math.PI-n)*Math.PI/180,u=b+Math.cos(t)*s*(r?-1:1),v=c+Math.sin(t)*s*(r?-1:1);return{x:u,y:v}},isPointerInside:function(a,b){var c=a.getOrigin();if(a.type==="line"){var d=Math.abs(a._.end_x-a.abs_x),e=Math.abs(a._.end_y-a.abs_y),f=Math.sqrt(d*d+e*e),g=a.start,h=a.end,i=g.x<h.x&&g.y<h.y||g.x>h.x&&g.y>h.y?-1:1,j=Math.asin(e/f)*(180/Math.PI)*i,k=this.transformPointerPosition(a,a.abs_x,a.abs_y,j,b);return k.x>a.abs_x-f-c.x&&k.x<a.abs_x+f-c.x&&k.y>a.abs_y-a.strokeWidth/2-c.y&&k.y<a.abs_y+a.strokeWidth/2-c.y}if(a.type==="text"){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),l=a.strokeWidth/2,m=a._.lines,n=m.length,o=a.size*a.lineHeight,p=a.align,q=this.core.canvasElement.dir==="rtl",r,s,t,u,v,w,x,y;r={top:a.size*.05,hanging:a.size*-0.12,middle:a.size*-0.47,alphabetic:a.size*-0.78,ideographic:a.size*-0.83,bottom:a.size*-1};for(s=0;s<n;s++){t={start:q?a.width-m[s].width:0,left:0,center:(a.width-m[s].width)/2,end:q?0:a.width-m[s].width,right:a.width-m[s].width},u=a.abs_x+t[p],v=u+m[s].width,w=a.abs_y+o*s+r[a.baseline],x=w+o+(n>0&&s<n-1?1:0),y=k.x>u-c.x-l&&k.x<v-c.x+l&&k.y>w-c.y-l&&k.y<x-c.y+l;if(y)return!0}return!1}if(a.shapeType==="rectangular"){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),l=a.strokePosition==="outside"?a.strokeWidth:a.strokePosition==="center"?a.strokeWidth/2:0;return k.x>a.abs_x-c.x-l&&k.x<a.abs_x+a.width-c.x+l&&k.y>a.abs_y-c.y-l&&k.y<a.abs_y+a.height-c.y+l}if(a.type==="ellipse"&&a.radius_x===a.radius_y){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),f=Math.sqrt(Math.pow(k.x-a.abs_x+c.x,2)+Math.pow(k.y-a.abs_y+c.y,2));return f<a.radius_x+a.strokeWidth/2}if(a.type==="ellipse"){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),z=a.radius_x+a.strokeWidth/2,A=a.radius_y+a.strokeWidth/2;k.x-=a.abs_x+c.x,k.y-=a.abs_y+c.y;return k.x*k.x/(z*z)+k.y*k.y/(A*A)<1}if(a.type==="polygon"){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),B=a.radius+a.strokeWidth/2,C=a.sides,D=C-1,E=!1,s,F,G;for(s=0;s<C;s++)F={x:a.abs_x-c.x+B*Math.cos(s*2*Math.PI/C),y:a.abs_y-c.y+B*Math.sin(s*2*Math.PI/C)},G={x:a.abs_x-c.x+B*Math.cos(D*2*Math.PI/C),y:a.abs_y-c.y+B*Math.sin(D*2*Math.PI/C)},(F.y<k.y&&G.y>=k.y||G.y<k.y&&F.y>=k.y)&&F.x+(k.y-F.y)/(G.y-F.y)*(G.x-F.x)<k.x&&(E=!E),D=s;return E}if(a.type==="arc"){var H=a.end-a.start,I=a.direction==="clockwise"?(H<0?360:0)+(H%360?H%360:H>0?360:0):Math.abs(H),J=a.direction==="clockwise"?a.start*-1:a.end*-1,k=this.transformPointerPosition(a,a.abs_x,a.abs_y,J,b),f=Math.sqrt(Math.pow(k.x-a.abs_x+c.x,2)+Math.pow(k.y-a.abs_y+c.y,2)),B=a.radius,K={},L={},z,M,N,j;if(a.strokeWidth===0&&f>B||a.strokeWidth>0&&f>B+a.strokeWidth/2)return!1;if(B===a.strokeWidth/2||a.pieSection){var O=a.pieSection?a.radius:O;if(I>180){var P,Q,R,S;P=Math.abs(a.abs_x-c.x-k.x),Q=Math.abs(a.abs_y-c.y-k.y),R=Math.sqrt(P*P+Q*Q),S=Math.acos(P/R)*180/Math.PI;return k.y>=a.abs_y-c.y&&f<=O?!0:k.y<a.abs_y-c.y&&k.x<a.abs_x-c.x&&S<=I-180?!0:!1}if(I===180)return k.y>=a.abs_y-c.y&&f<=O?!0:!1;if(I<180){J=90-I/2-(a.direction==="clockwise"?a.start:a.end),k=this.transformPointerPosition(a,a.abs_x,a.abs_y,J,b);var T,P,Q,R,S;B*=2,T=Math.cos(I/2*Math.PI/180)*B,P=Math.abs(a.abs_x-c.x-k.x),Q=Math.abs(a.abs_y-c.y-k.y),R=Math.sqrt(P*P+Q*Q),S=Math.asin(P/R)*180/Math.PI;return k.y>=a.abs_y-c.y+T?!0:k.y>=a.abs_y-c.y&&S<=I/2?!0:!1}}else{if(I>180){z=(360-I)/2,M=Math.cos(z*Math.PI/180)*B,K.x=a.abs_x-c.x+Math.cos(z*Math.PI/180)*M,K.y=a.abs_y-c.y-Math.sin(z*Math.PI/180)*M,N=180-2*z,L.x=a.abs_x-c.x-Math.cos(N*Math.PI/180)*B,L.y=a.abs_y-c.y-Math.sin(N*Math.PI/180)*B;var U=90-(90-N)-(90-z);if(k.y<K.y&&k.x<K.x)j=z-Math.acos(Math.abs(k.y-K.y)/Math.sqrt(Math.pow(k.x-K.x,2)+Math.pow(k.y-K.y,2)))*180/Math.PI;else if(k.y>K.y&&k.x>=K.x)j=U-Math.acos(Math.abs(k.x-K.x)/Math.sqrt(Math.pow(k.x-K.x,2)+Math.pow(k.y-K.y,2)))*180/Math.PI;else{if(k.y<a.abs_y-c.y&&k.x>=K.x)return!1;j=-1e6}if((a.fill===""||a.fill==="transparent")&&a.strokeWidth>0&&f<B-a.strokeWidth/2)return!1;return j<=0&&k.x>=L.x&&k.y>K.y&&k.y<a.abs_y-c.y?!0:j<=0&&k.y<=a.abs_y-c.y&&f<=B?!0:(a.strokeWidth===0&&f<=B||a.strokeWidth>0&&f<=B+a.strokeWidth/2)&&(k.x<=L.x&&k.y<=a.abs_y-c.y||k.y>=a.abs_y-c.y)?!0:!1}if(I===180)return k.y>=a.abs_y-c.y&&(a.strokeWidth===0&&f<=B||a.strokeWidth>0&&f<=B+a.strokeWidth/2)?!0:!1;if(I<180){J=90-I/2-(a.direction==="clockwise"?a.start:a.end),k=this.transformPointerPosition(a,a.abs_x,a.abs_y,J,b);var V,T;V=a.fill===""?B-a.strokeWidth/2:B,T=Math.cos(I/2*Math.PI/180)*V;return a.fill===""&&a.strokeWidth>0?k.y>=a.abs_y-c.y+T&&f>=B-a.strokeWidth/2&&f<=B+a.strokeWidth/2?!0:!1:k.y>=a.abs_y-c.y+T?a.strokeWidth>0?f<=B+a.strokeWidth/2?!0:!1:!0:!1}}}else if(a.shapeType==="radial"){var B=a.radius?a.radius:0;if(B>0){var k=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),c=a.getOrigin(),f=Math.sqrt(Math.pow(k.x-a.abs_x+c.x,2)+Math.pow(k.y-a.abs_y+c.y,2));return f<B}}}}};d.registerModule("tools",i);var j=function(){return{enabled:!0,eventTypes:{},init:function(){this.core.canvasElement.events={}},addEventTypes:function(a,b){this.eventTypes[a]=this.eventTypes[a]||[];var c=this.eventTypes[a];for(var d in b)c[d]=c[d]||[],c[d].push(b[d])},bind:function(a,b,c){for(var d=0;d<b.length;d++)a.events[b[d]]=a.events[b[d]]||[],a.events[b[d]].push(c)},unbind:function(a,b,d){var e,f,g;for(e=0;e<b.length;e++){f=a.events[b[e]];if(f===c)continue;d===c?delete a.events[b[e]]:(g=f.indexOf(d),~g&&f.splice(g,1))}},findFrontObject:function(a,b){var c,d,e;if(a.length===0)return!1;for(c=a.length;c--;){d=a[c],e=this.findFrontObject(d.children,b);if(e!==!1)break;if(d.pointerEvents&&d.isPointerInside(b)){e=d;break}}return e},getFrontObject:function(a){return this.findFrontObject(this.core.children,this.core[a])||c},triggerPointerEvent:function(a,b,c,d){if(!!this.enabled){var e,f,g,h,i,j,k,l,m,n,o;e=this.core.canvasElement,f=this.eventTypes[c],g=f.enter,h=f.leave,i=f[a],j=f.singleClick,this.lastPointerEventObject=this.fixEventObject(d,c);if(b){if(b!==this.frontObject){if(this.frontObject){k=this.getParentChain(b);if(!~k.indexOf(this.frontObject)){this.triggerHandlers(this.frontObject,h),k=this.getParentChain(this.frontObject);if(!~k.indexOf(b))this.triggerChain(k,h);else{l=[];for(n=0,o=k.length;n<o;n++){if(k[n]===b)break;l.push(k[n])}this.triggerChain(l,h)}}}this.frontObject=b,(b.parent||e).events.hasEntered||(k=this.findNonEnteredParentChain(b),this.triggerChain(k,g)),b.events.hasEntered||this.triggerHandlers(b,g)}}else this.frontObject?(l=this.getParentChain(this.frontObject,!1,!0),this.triggerChain(l,h),this.frontObject=null):e.events.hasEntered||this.triggerHandlers(e,g),b=this.core.canvasElement;a==="down"&&(this.lastDownObject=b),l=this.getParentChain(b,!0,!0),this.triggerChain(l,i),a==="up"&&(b===this.lastDownObject?this.triggerChain(l,j):(m=this.getSharedParent(b,this.lastDownObject),m&&(l=this.getParentChain(m,!0,!0),this.triggerChain(l,j))),this.lastDownObject=null)}},getSharedParent:function(a,b){var d,e,f;d=this.getParentChain(a,!0,!0),e=this.core.canvasElement,f=b;while(f){if(~d.indexOf(f))break;f=f.parent||(f!==e?e:c)}return f},findNonEnteredParentChain:function(a){var b,c,d;b=[],c=this.core.canvasElement,d=a.parent;while(d){if(d.events.hasEntered)break;b.push(d),d=d.parent}!d&&!c.events.hasEntered&&b.push(c);return b.reverse()},getParentChain:function(a,b,c){var d,e;d=[],c&&d.push(a),e=a.parent;while(e)d.push(e),e=e.parent;b&&a!==this.core.canvasElement&&d.push(this.core.canvasElement);return d},triggerChain:function(a,b,c){var d,e,f;for(d=0,e=a.length;d<e;d++){f=this.triggerHandlers(a[d],b,c);if(!f)break}},triggerHandlers:function(a,b,c){var d,e,f,g,h,i,j,k=a===this.core.canvasElement?this.core:a;for(d=0;d<b.length;d++){e=a.events[b[d]],f=!!~b[d].indexOf("enter"),g=!!~b[d].indexOf("leave"),j=c||(~b[d].indexOf("key")?this.lastKeyboardEventObject:this.lastPointerEventObject),j.type=b[d],j.bubbles=f||g?!1:!0,f&&!a.events.hasEntered?a.events.hasEntered=!0:g&&a.events.hasEntered&&(a.events.hasEntered=!1);if(e){h=e.length;for(i=0;i<h;i++)typeof e[i]=="function"&&e[i].call(k,j);if(j.stoppingPropagation){j.stoppingPropagation=!1;return!1}}}return!0},fixEventObject:function(a,b){var d="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),e=d.length,f,g,h,i;f={originalEvent:a,timeStamp:(new Date).getTime(),which:a===c?0:a.which===0?a.keyCode:a.which,preventDefault:function(){a!==c&&a.preventDefault()},stopPropagation:function(){this.bubbles&&(this.stoppingPropagation=!0),a!==c&&a.stopPropagation()}};if(a===c)return f;for(g=0;g<e;g++)h=d[g],a[h]!==c&&(f[h]=a[h]);~"mouse touch".indexOf(b)&&(f.x=this.core[b].x,f.y=this.core[b].y),b==="mouse"&&(i={0:1,2:2,1:3,"default":0},f.which=i[f.button]||i["default"]),b==="touch"&&(f.which=0);return f}}};d.registerModule("events",j,"init");var k=function(){return{objects:[],translation:{x:0,y:0},changeZorder:function(a,b,d){var e=a.children,f=e[b],g=e[d],h,i,j,k;if(f!==c){if(b===d)return;d>e.length-1&&(d=e.length-1),d<0&&(d=0),d>b?(h=e.slice(0,b),j=e.slice(d+1,e.length),i=e.slice(b,d+1),i.shift(),i.push(f)):(h=e.slice(0,d),j=e.slice(b+1,e.length),i=e.slice(d,b+1),i.pop(),i.unshift(f)),a.children=h.concat(i).concat(j)}},clear:function(a){this.core.canvas.clearRect(0,0,this.core.width,this.core.height),a!==!1&&this.core.background.redraw(),this.isCleared=!0;return this},redraw:function(a){a=a||!1,(this.core.settings.clearEachFrame||a)&&this.clear(),this.isCleared=!1,this.drawObjects(this.core.children);return this},drawObjects:function(a){var b=this.core.canvas,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(d=0,e=a.length;d<e;d++){f=a[d];if(f!==c&&typeof f.draw=="function"){typeof f.update=="function"&&f.update(),b.save(),j=[],j.push(f),o=f.parent;while(o&&o!==this.core)j.push(o),o=o.parent;j.reverse(),k=0,l=0,q=1;for(m=0,n=j.length;m<n;m++)g=j[m],b.translate(g.abs_x-k,g.abs_y-l),g.rotation!==0&&b.rotate(g.rotation*Math.PI/180),(g.scalingX!==1||g.scalingY!==1)&&b.scale(g.scalingX,g.scalingY),q*=g.opacity,k=g.abs_x,l=g.abs_y;this.translation={x:k,y:l},h=f.abs_x,i=f.abs_y,f._.abs_x=0,f._.abs_y=0,b.globalAlpha=isNaN(parseFloat(q))?1:parseFloat(q),b.globalCompositeOperation=f.composition,p=f.shadow,p.blur>0&&(b.shadowOffsetX=p.offsetX,b.shadowOffsetY=p.offsetY,b.shadowBlur=p.blur,b.shadowColor=p.color),b.lineCap=f.cap,b.lineJoin=f.join,b.miterLimit=f.miterLimit,f.draw(),f.drawn=!0,f._.abs_x=h,f._.abs_y=i,b.lineCap="butt",b.lineJoin="miter",b.miterLimit=10,b.restore(),this.translation={x:0,y:0},f.children.length>0&&this.drawObjects(f.children)}}}}};d.registerModule("draw",k);var l=function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(a){var b=this;typeof a!="string"&&(a=""),this.value=a,~a.indexOf("gradient")?this.type="gradient":~a.indexOf("image")?this.type="image":this.core.style&&this.core.style.isColor(a)?this.type="color":this.type="transparent";if(this.type==="color")this.bg=a,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="gradient")this.bg=this.core.style?this.core.style.getGradient(a,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="image"){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),d=c[1],e=c[4]||"repeat",f=new Image;f.src=d,f.onload=function(){b.bg=b.core.canvas.createPattern(this,e),b.loaded=!0,b.core.timeline&&!b.core.timeline.running&&b.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(){var a=this.core;this.type!=="transparent"&&(a.canvas.fillStyle=this.bg,a.canvas.fillRect(0,0,a.width,a.height))}}};d.registerModule("background",l,"init");var m=function(){return{current:"none",scenes:{},create:function(a,b){this.scenes[a]=Object.create(this.scenesBase()),this.scenes[a].name=a,b.call(this.scenes[a]);return this.scenes[a]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(a){this.objects.push(a),this.loaded&&a.add();return this},remove:function(a){var b=this.objects.indexOf(a);~b&&(this.objects.splice(b,1),this.loaded&&a.remove());return this},load:function(){if(!this.loaded){var a=this.objects,b,d=a.length;for(b=0;b<d;b++)a[b]!==c&&a[b].add(!1);this.loaded=!0;return this}},unload:function(){var a=this.objects,b,d=a.length;for(b=0;b<d;b++)a[b]!==c&&a[b].remove(!1);this.loaded=!1;return this}}},load:function(a,b){b===!0&&this.current!=="none"&&this.unload(this.current),this.current=a,this.scenes[a].load(),this.core.draw.redraw();return this},unload:function(a){this.current="none",this.scenes[a].unload(),this.core.draw.redraw();return this}}};d.registerModule("scenes",m);var n=function(){return{getStroke:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var d=a;a=typeof d.pos=="string"?d.pos:"center",a+=" "+(typeof d.width=="number"?d.width+"px":"1px"),a+=" "+(typeof d.color=="string"?d.color:"#000000")}var e=a.split(" "),f,g;for(var h=0,i=e.length;h<i;h++)!f&&e[h].indexOf("(")>-1&&(f=h),e[h].indexOf(")")>-1&&(g=h);var j=g?e.splice(f,g-f+1):c;j&&e.push(j.join(" "));var k=["outside","center","inside"],l="",h,m=e.length,n,o,j,p;if(m>=3)if(!~k.indexOf(e[0])){p=isNaN(parseInt(e[0]));for(h=p?0:1;h<m;h++)l+=e[h]+(h===m-1?" ":"");p?e=[1,l]:e=[e[0],l],m=2}else{if(m>3){for(h=2;h<m;h++)l+=e[h]+(h===m-1?" ":"");e=[e[0],e[1],l]}e={pos:e[0],width:parseFloat(e[1]),color:e[2]}}m===2&&(e={pos:"center",width:parseFloat(e[0]),color:e[1]}),e.length&&(e={pos:"center",width:0,color:""});if(b==="string")return e.pos+" "+e.width+"px "+e.color;if(b==="object")return e},getGradient:function(a,b,c,d,e){return~a.indexOf("linear")?this.getLinearGradient(a,b,c,d,e):~a.indexOf("radial")?this.getRadialGradient(a,b,c,d,e):"transparent"},getLinearGradient:function(a,b,c,d,e){var f,g,h,i=[],j,k,l,m,n,o,p=["top","bottom","left","right"],q,r,s=[],t,u;g=/\((.*)\)/.exec(a)[1];while(q=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(g))r=s.push(q[1])-1,g=g.substring(0,q.index)+"###"+r+"###"+g.substring(q.index+q[1].length,g.length);g=g.split(","),h=g[0].split(" "),(~p.indexOf(h[0])||~h[0].indexOf("deg"))&&i.push(h[0]),h.length>1&&~p.indexOf(h[1])&&i.push(h[1]),i.length===0?i.push("top"):k=1;if(i.length===1){if(i[0]==="top")l=b+d/2,m=c,n=b+d/2,o=c+e;else if(i[0]==="right")l=b+d,m=c+e/2,n=b,o=c+e/2;else if(i[0]==="bottom")l=b+d/2,m=c+e,n=b+d/2,o=c;else if(i[0]==="left")l=b,m=c+e/2,n=b+d,o=c+e/2;else if(~i[0].indexOf("deg")){var v,w,x,y,z,A,B,C,D=Math.PI,E=b+d/2,F=c+e/2;v=parseFloat(i)%360*D/180,w=v,v>=0&&v<D/2?(A=b+d,B=c):v>=D/2&&v<D?(C=F,F=E,B=b,A=C,E=c):v>=D&&v<D*1.5?(C=F,A=E,E=b,F=c+e,B=C):v>=D*1.5&&v<D*2&&(C=F,F=b+d,B=E,A=c+e,E=C),v=v%(D/2),x=Math.atan(Math.abs(F-B)/Math.abs(A-E)),y=Math.sqrt(Math.pow(F-B,2)+Math.pow(E-A,2)),z=y*Math.cos(x-v),w>=0&&w<D/2?(n=E+z*Math.cos(v),o=F-z*Math.sin(v),l=E*2-n,m=F*2-o):w>=D/2&&w<D?(n=F-z*Math.cos(D/2-v),o=A-z*Math.sin(D/2-v),l=F*2-n,m=A*2-o):w>=D&&w<D*1.5?(n=A+z*Math.cos(D-v),o=B+z*Math.sin(D-v),l=A*2-n,m=B*2-o):w>=D*1.5&&w<D*2&&(n=B-z*Math.cos(D*1.5-v),o=E-z*Math.sin(D*1.5-v),l=B*2-n,m=E*2-o)}}else~i.indexOf("top")&&~i.indexOf("left")?(l=b,m=c,n=b+d,o=c+e):~i.indexOf("top")&&~i.indexOf("right")?(l=b+d,m=c,n=b,o=c+e):~i.indexOf("bottom")&&~i.indexOf("left")?(l=b,m=c+e,n=b+d,o=c):~i.indexOf("bottom")&&~i.indexOf("right")&&(l=b+d,m=c+e,n=b,o=c);f=this.core.canvas.createLinearGradient(l,m,n,o),t=this.getColorStops(f,g.slice(k),s);for(u=0;u<t.length;u++)f.addColorStop(t[u].pos/100,t[u].color);return f},getRadialGradient:function(a,b,d,e,f){var g,h=["left","center","right"],i=["top","center","bottom"],j={left:b,center:b+e/2,right:b+e},k={top:d,center:d+f/2,bottom:d+f},l=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],m,n,o,p,q,r=[],s,t,u,v=0,w=[{x:c,y:c,r:0},{x:c,y:c,r:c}],x,y,z,A,B=!1;m=/\((.*)\)/.exec(a)[1];while(p=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(m))q=r.push(p[1])-1,m=m.substring(0,p.index)+"###"+q+"###"+m.substring(p.index+p[1].length,m.length);m=m.split(/\s*,\s*/),o=m.length;for(n=0;n<2;n++)if(~m[n].indexOf(" ")){u=m[n].split(" ");if(u[0]==="center")w[n].x=u[0],w[n].y=u[1],v=n+1;else if(~h.indexOf(u[0]))w[n].x=u[0],v=n+1,~i.indexOf(u[1])&&(w[n].y=u[1]);else if(~i.indexOf(u[0]))w[n].y=u[0],v=n+1,~h.indexOf(u[1])&&(w[n].x=u[1]);else if(!isNaN(parseFloat(u[0]))){w[n].x=u[0],v=n+1;if(~i.indexOf(u[1])||!isNaN(parseFloat(u[1])))w[n].y=u[1]}w[n].x||(w[n].x="center"),w[n].y||(w[n].y="center")}else~h.indexOf(m[n])?(w[n].x=m[n],v=n+1):~i.indexOf(m[n])?(w[n].y=m[n],v=n+1):n===1?w[n].x=w[0].x:w[n].x="center",n===1?w[n].y=w[0].y:w[n].y="center";~l.indexOf(m[v])&&(A=m[v],B=!0),/\d+(%|px)\s/.test(m[v])&&(A=parseFloat(m[v]),B=!0,isNaN(A)&&(A=0)),A===c&&(A="cover");for(n=0;n<2;n++){w[n].abs_x=j[w[n].x],w[n].abs_y=k[w[n].y];for(x=0;x<2;x++)y="abs_"+(x===0?"x":"y"),w[n][y]===c&&(w[n][y]=parseFloat(w[n][y==="abs_x"?"x":"y"]),isNaN(w[n][y])&&(w[n][y]=y==="abs_x"?j.center-b:k.center-d),~w[n][y==="abs_x"?"x":"y"].indexOf("%")&&(w[n][y]=w[n][y]/100*(y==="abs_x"?e:f)),w[n][y]+=y==="abs_x"?b:d)}~l.indexOf(A)&&(A==="closest-side"||A==="contain"?A=Math.min(Math.abs(w[1].abs_y-d),Math.abs(d+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A==="closest-corner"?A=Math.min(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(d+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(d+f-w[1].abs_y,2))):A==="farthest-corner"||A==="cover"?A=Math.max(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(d+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(d+f-w[1].abs_y,2))):A==="farthest-side"?A=Math.max(Math.abs(w[1].abs_y-d),Math.abs(d+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A=0),~m[v].indexOf("%")&&(~m[v].indexOf(" ")?z=m[v].split(" ")[1]==="height"?f:e:z=e,A=A/100*z),w[1].r=A,g=this.core.canvas.createRadialGradient(w[0].abs_x,w[0].abs_y,w[0].r,w[1].abs_x,w[1].abs_y,w[1].r),s=this.getColorStops(g,m.slice(v+(B?1:0)),r);for(t=0;t<s.length;t++)g.addColorStop(s[t].pos/100,s[t].color);return g},getColorStops:function(a,b,d){var e,f=b.length,g,h,i,j,k=[];for(e=0;e<f;e++){g=b[e].trim();if(j>=100)break;~g.indexOf(" ")?(h=g.split(" "),i=h[0],j=h[1],~j.indexOf("px")?j=parseFloat(j)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:j=parseFloat(j)):(i=g,j===c?j=0:(j=j||0,j=j+(100-j)/(f-e))),~i.indexOf("###")&&(i=d[/###(\d+)###/.exec(i)[1]]),k.push({pos:j,color:i})}return k},getFont:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var d=a;a=typeof d.style=="string"?d.style:"normal",a+=" "+(typeof d.variant=="string"?d.variant:"normal"),a+=" "+(typeof d.weight=="string"?d.weight:"normal"),a+=" "+(typeof d.size=="number"?~~(d.size*10+.5)/10+"px":"16px"),a+="/"+(typeof d.lineHeight=="number"?~~(d.lineHeight*10+.5)/10:typeof d.lineHeight=="string"?d.lineHeight.indexOf("px")>-1?d.lineHeight:1:1),a+=" "+(typeof d.family=="string"?d.family:"sans-serif")}if(a.length>0){var e=a.split(" "),f=e.length,g,a,h,i,j="",k=["normal","italic","oblique"],l=["normal","small-caps"],m=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],n={};for(g=0;g<f;g++){a=e[g];if(~k.indexOf(a)&&!n.style)n.style=a;else if(~l.indexOf(a)&&!n.variant)n.variant=a;else if(~m.indexOf(a)&&!n.weight)n.weight=a;else if(~a.indexOf("/")&&!n.size&&!n.lineHeight)h=a.split("/"),isNaN(parseInt(h[0]))||(n.size=parseInt(h[0])),isNaN(parseFloat(h[1]))||(n.lineHeight=parseFloat(h[1]),n.lineHeightUnit=h[1].indexOf("px")>-1?"px":"relative");else if(!n.size&&/\d+[a-z]{2}(?!\/)/.test(a))isNaN(parseInt(a))||(n.size=parseInt(a));else if(isNaN(parseInt(a))&&!n.family){j="";for(i=g;i<f;i++)j+=e[i]+(i===f-1?"":" ");n.family=j}}}e=n||{},e.style=e.style?e.style:"normal",e.variant=e.variant?e.variant:"normal",e.weight=e.weight?e.weight:"normal",e.size=e.size!==c?e.size:16,e.lineHeight=e.lineHeight!==c?e.lineHeight:1,e.lineHeightUnit=e.lineHeightUnit!==c?e.lineHeightUnit:"relative",e.family=e.family?e.family:"sans-serif";if(b==="string")return e.style+" "+e.variant+" "+e.weight+" "+e.size+"px/"+e.lineHeight+(e.lineHeightUnit==="px"?"px":"")+" "+e.family;if(b==="object")return e},getShadow:function(a,b){var c={},d;if(typeof a=="object")c.offsetX=isNaN(parseFloat(a.offsetX))?0:parseFloat(a.offsetX),c.offsetY=isNaN(parseFloat(a.offsetY))?0:parseFloat(a.offsetY),c.blur=isNaN(parseFloat(a.blur))?0:parseFloat(a.blur),c.color=this.isColor(a.color)?a.color:"#000";else if(typeof a=="string"){var d=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(a);c.offsetX=isNaN(parseFloat(d[1]))?0:parseFloat(d[1]),c.offsetY=isNaN(parseFloat(d[2]))?0:parseFloat(d[2]),c.blur=isNaN(parseFloat(d[3]))?0:parseFloat(d[3]),c.color=this.isColor(d[4])?d[4]:"#000"}return b==="string"?c.offsetX+"px "+c.offsetY+"px "+c.blur+"px "+c.color:c},isColor:function(a){return typeof a!="string"||a[0]!=="#"&&a.substr(0,4)!=="rgb("&&a.substr(0,5)!=="rgba("&&a.substr(0,4)!=="hsl("&&a.substr(0,5)!=="hsla("?!1:!0}}};d.registerModule("style",n),a.logs=[];var o=function(){var a={durations:{"short":500,normal:1e3,"long":2e3},defaults:{duration:"normal",easing:"ease-in-out"},animate:function(a,b){var c=this.parseArguments(b),d=c.properties,e=c.options,f=this.queues.create(a,e.queue),g={obj:a,properties:d,startValues:{},diffValues:{},options:{queue:f,duration:e.duration,easing:e.easing,callback:e.callback}};f.add(g),f.run()},parseArguments:function(a){a=Array.prototype.slice.call(a),a[1]=a[1]||{};var b;typeof a[1]=="object"?(props=a[0],b=d.extend({duration:this.defaults.duration,easing:this.defaults.easing,queue:"default",callback:function(){}},a[1]),b.easing=this.parseEasingOption(b.easing),b.duration=this.parseDurationOption(b.duration)):(props=a.shift(),b=this.getAnimateArguments(a));return{properties:props,options:b}},parseEasingOption:function(a){if(typeof a=="string")return~a.indexOf("cubic-bezier")?this.getCustomCubicBezier(a)||this.easing[this.defaults.easing]:this.easing[a]||this.easing[this.defaults.easing];if(typeof a!="function")return this.easing[this.defaults.easing]},parseDurationOption:function(b){var c=a.durations;if(typeof b=="string")return c[b]||c[a.defaults.duration];return b},runAnimation:function(a,b){var c,d,e,f;c=a.obj,e=a.options,a.advanceCallback=b,this.mainTimer.add(a);var d=this.parseProperties(a.properties,c);a.properties=d.properties,a.startValues=d.startValues,a.diffValues=d.diffValues,a.startTime=(new Date).getTime()},parseProperties:function(a,b){var c={},e={};for(var f in a)if(d.isNumber(a[f]))c[f]=b[f]||0,e[f]=a[f]-(b[f]||0);else if(typeof a[f]=="object"){var g=this.parseProperties(a[f],b[f]);c[f]=g.startValues,e[f]=g.diffValues}else delete a[f];return{properties:a,startValues:c,diffValues:e}},tick:function(a){var b,c,d,e,f,g;b=(new Date).getTime()-a.startTime,c=b/a.options.duration;if(c>1){this.setEndValues(a);return!1}a.options.easing.length===1?d=a.options.easing.call(this.easing,c):d=a.options.easing.call(this.easing,b,0,1,a.options.duration),e=a.startValues,f=a.diffValues;for(g in f)this.setObjectProperty(a.obj,g,e[g],f[g],d);return!0},setObjectProperty:function(a,b,c,e,f){if(d.isNumber(c))a[b]=c+e*f;else for(var g in c)this.setObjectProperty(a[b],g,c[g],e[g],f)},setEndValues:function(a){var b=a.obj,c=a.startValues,d=a.diffValues;for(var e in a.properties)this.setObjectProperty(b,e,c[e],d[e],1);this.core.timeline.running||this.core.draw.redraw(!0)},getAnimateArguments:function(a){var b,d,e,f;typeof a[0]=="number"?b=a[0]:typeof a[0]=="string"?a[0]in this.durations?b=this.durations[a[0]]:a[0]in this.easing&&(d=this.easing[a[0]]):typeof a[0]=="boolean"?e=a[0]:typeof a[0]=="function"&&typeof a[1]=="function"&&(d=a[0],f=a[1]),typeof a[1]=="string"?d=this.easing[a[1]]:typeof a[1]=="function"&&(a[2]!==c?d=a[1]:f=a[1]),a[2]!==c&&(typeof a[2]=="function"?f=a[2]:e=!!a[2]),a[3]!==c&&(f=a[3]),d||(d=typeof a[0]=="string"?a[0]:"",d=~d.indexOf("cubic-bezier")?d:c,d||(d=typeof a[1]=="string"?a[1]:"",d=~d.indexOf("cubic-bezier")?d:c),d&&(d=this.getCustomCubicBezier(d))),b=b||this.durations[this.defaults.duration],d=d||this.easing[this.defaults.easing],e=e!==c?e:!1,f=f||function(){};return{duration:b,easing:d,queue:e?c:"default",callback:f}},getCustomCubicBezier:function(a){var b,c,d,e,f;b=a.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/);if(!!b){c=isNaN(parseFloat(b[1]))?0:parseFloat(b[1]),d=isNaN(parseFloat(b[2]))?0:parseFloat(b[2]),e=isNaN(parseFloat(b[3]))?1:parseFloat(b[3]),f=isNaN(parseFloat(b[4]))?1:parseFloat(b[4]);return function(a){return this.cubicBezier(c,d,e,f,a)}}},stop:function(a){for(var b in a.animationQueues)a.animationQueues[b].clear(!1)},finish:function(a){for(var b in a.animationQueues)a.animationQueues[b].clear(!0)},delay:function(a,b,c){var d=a.animationQueues[c&&c.queue||"default"];d&&d.add({type:"delay",duration:b||0})},mainTimer:{animations:[],add:function(a){this.animations.push(a),this.animations.length===1&&this.start()},remove:function(a){this.animations.splice(this.animations.indexOf(a),1),this.animations.length===0&&this.stop()},start:function(){this.tick()},stop:function(){cancelAnimationFrame(this.timer)},tick:function(){var b=this;setTimeout(function(){b.timer=requestAnimationFrame(function(){b.tick()});var c=b.animations,d;for(var e=0,f=c.length;e<f;e++)d=c[e],d.cancelled||a.tick(d)||(a.mainTimer.remove(d),e--,f--,d.advanceCallback(),d.options.callback.call(d.obj));a.core.timeline.running||a.core.draw.redraw(!0)},1e3/a.core.settings.fps)}},queues:{create:function(b,d){d===c&&(d=Math.round((new Date).getTime()*Math.random())+""),b.animationQueues[d]||(b.animationQueues[d]={name:d,list:[],isRunning:!1,add:function(a){this.list.push(a)},remove:function(a){if(a){var b=this.list.indexOf(a);~b&&this.list.splice(b,1)}else this.list.shift()},run:function(){if(!this.isRunning&&this.list.length>0){this.isRunning=!0;var b=this.list[0],c=this;b.type==="delay"?setTimeout(function(){c.advance()},b.duration):a.runAnimation(b,function(){c.advance()})}},advance:function(){this.list.shift(),this.isRunning=!1,this.run()},clear:function(b){if(this.isRunning){var c=this.list[0];c.cancelled=!0,b&&(a.setEndValues(c),c.options.callback.call(c.obj)),this.isRunning=!1,a.mainTimer.remove(c)}this.list.length=0}});return this.get(b,d)},get:function(a,b){return a.animationQueues[b]}},easing:{"ease-in":function(a){return this.cubicBezier(.42,0,1,1,a)},"ease-out":function(a){return this.cubicBezier(0,0,.58,1,a)},"ease-in-out":function(a){return this.cubicBezier(.42,0,.58,1,a)},linear:function(a){return a},"ease-in-quad":function(a,b,c,d){return c*(a/=d)*a+b},"ease-out-quad":function(a,b,c,d){return-c*(a/=d)*(a-2)+b},"ease-in-out-quad":function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a+b;return-c/2*(--a*(a-2)-1)+b},"ease-in-cubic":function(a,b,c,d){return c*(a/=d)*a*a+b},"ease-out-cubic":function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},"ease-in-out-cubic":function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a*a+b;return c/2*((a-=2)*a*a+2)+b},"ease-in-quart":function(a,b,c,d){return c*(a/=d)*a*a*a+b},"ease-out-quart":function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},"ease-in-out-quart":function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a*a*a+b;return-c/2*((a-=2)*a*a*a-2)+b},"ease-in-quint":function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},"ease-out-quint":function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},"ease-in-out-quint":function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a*a*a*a+b;return c/2*((a-=2)*a*a*a*a+2)+b},"ease-in-sine":function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},"ease-out-sine":function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},"ease-in-out-sine":function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},"ease-in-expo":function(a,b,c,d){return a==0?b:c*Math.pow(2,10*(a/d-1))+b},"ease-out-expo":function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},"ease-in-out-expo":function(a,b,c,d){if(a==0)return b;if(a==d)return b+c;if((a/=d/2)<1)return c/2*Math.pow(2,10*(a-1))+b;return c/2*(-Math.pow(2,-10*--a)+2)+b},"ease-in-circ":function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},"ease-out-circ":function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},"ease-in-out-circ":function(a,b,c,d){if((a/=d/2)<1)return-c/2*(Math.sqrt(1-a*a)-1)+b;return c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},"ease-in-elastic":function(a,b,c,d,e,f){e=e||0;if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b},"ease-out-elastic":function(a,b,c,d,e,f){e=e||0;if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b},"ease-in-out-elastic":function(a,b,c,d,e,f){e=e||0;if(a==0)return b;if((a/=d/2)==2)return b+c;f||(f=d*.3*1.5);if(e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);if(a<1)return-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b;return e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b},"ease-in-back":function(a,b,d,e,f){f==c&&(f=1.70158);return d*(a/=e)*a*((f+1)*a-f)+b},"ease-out-back":function(a,b,d,e,f){f==c&&(f=1.70158);return d*((a=a/e-1)*a*((f+1)*a+f)+1)+b},"ease-in-out-back":function(a,b,d,e,f){f==c&&(f=1.70158);if((a/=e/2)<1)return d/2*a*a*(((f*=1.525)+1)*a-f)+b;return d/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+b},"ease-in-bounce":function(a,b,c,d){return c-this["ease-out-bounce"](d-a,0,c,d)+b},"ease-out-bounce":function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},"ease-in-out-bounce":function(a,b,c,d){if(a<d/2)return this["ease-in-bounce"](a*2,0,c,d)*.5+b;return this["ease-in-out-bounce"](a*2-d,0,c,d)*.5+c*.5+b},cubicBezier:function(a,b,c,d,e){var f=0,g=0,h=1,i=1,j=h-3*c+3*a-f,k=3*c-6*a+3*f,l=3*a-3*f,m=f,n=i-3*d+3*b-g,o=3*d-6*b+3*g,p=3*b-3*g,q=g,r=e,s=5,t,u,v,w;for(t=0;t<s;t++)v=j*r*r*r+k*r*r+l*r+m,u=1/(3*j*r*r+2*k*r+l),r-=(v-e)*u,r=r>1?1:r<0?0:r;w=Math.abs(n*r*r*r+o*r*r+p*r*q);return w}}};return a};d.registerModule("animation",o);var p=function(){var a=function(a,b,c,d,e){var f=e.style.getStroke(a.stroke);f[b]=c,a.stroke=e.style.getStroke(f,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},events:{},children:[],added:!1,opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,pointerEvents:!0,animationQueues:{},_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,drawn:!1,stroke:"",strokeColor:"",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(b){a(this,"color",b,"strokeColor",this.core)},set strokeWidth(b){a(this,"width",b,"strokeWidth",this.core)},set strokePosition(b){a(this,"pos",b,"strokePosition",this.core)},set stroke(a){typeof a!="string"&&(a=this.core.style.getStroke(a,"string"));var b=this.core.style.getStroke(a);if(~b.color.indexOf("image(")){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(b.color),d=c[1],e=c[4]||"repeat",f=new Image,g=this;f.src=d,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,f.onload=function(){g._.strokeColor=g.core.canvas.createPattern(this,e),g._.strokepattern_loading=!1,g._.strokepattern_redraw&&(g._.strokepattern_redraw=!1,g.redraw())}}else this._.strokeColor=b.color;this._.strokeWidth=b.width,this._.strokePosition=b.pos,this._.stroke=a},set cap(a){var b=["butt","round","square"];this._.cap=~b.indexOf(a)?a:"butt"},set join(a){var b=["round","bevel","miter"];this._.join=~b.indexOf(a)?a:"miter"},set miterLimit(a){this._.miterLimit=isNaN(parseFloat(a))?10:parseFloat(a)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading){this._.strokepattern_redraw=!0;return""}if(~(this._.strokeColor+"").indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var a=this.getOrigin();if(this.shapeType==="rectangular"){var b=this.strokePosition==="outside"?this.strokeWidth:this.strokePosition==="center"?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-b,this.abs_y-a.y-b,this.width+b*2,this.height+b*2)}if(this.shapeType==="radial"){var c=this.radius+this.strokeWidth/2;a.x+=this.radius,a.y+=this.radius;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,c*2,c*2)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(a){if(~a.indexOf("image(")){var b=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),c=b[1],d=b[4]||"repeat",e=new Image,f=this;e.src=c,this._.pattern_loading=!0,this._.pattern_redraw=!1,e.onload=function(){f._.fill=f.core.canvas.createPattern(this,d),f._.pattern_loading=!1,f._.pattern_redraw&&(f._.pattern_redraw=!1,f.redraw())}}else this._.fill=a},get fill(){if(this._.pattern_loading){this._.pattern_redraw=!0;return""}if(~(this._.fill+"").indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var a=this.getOrigin();if(this.shapeType==="rectangular")return this.core.style.getGradient(this._.fill,this.abs_x-a.x,this.abs_y-a.y,this.width,this.height);if(this.shapeType==="radial")return this.core.style.getGradient(this._.fill,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,this.radius*2,this.radius*2)},set shadow(a){typeof a!="string"&&(a=this.core.style.getShadow(a,"string"));var b=this.core.style.getShadow(a);this._.shadow=b},set shadowOffsetX(a){isNaN(parseFloat(a))||(this._.shadow.offsetX=parseFloat(a))},set shadowOffsetY(a){isNaN(parseFloat(a))||(this._.shadow.offsetY=parseFloat(a))},set shadowBlur(a){isNaN(parseFloat(a))||(this._.shadow.blur=parseFloat(a))},set shadowColor(a){this.core.style.isColor(a)&&(this._.shadow.color=a)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(a){this._.x=a,this._.abs_x=a+(this.parent!==c&&this.parent!==this.core?this.parent.abs_x:0);var b=this.children,d=b.length,e;for(e=0;e<d;e++)b[e]._.abs_x=this.abs_x+b[e].x,b[e].x+=0},set y(a){this._.y=a,this._.abs_y=a+(this.parent!==c&&this.parent!==this.core?this.parent.abs_y:0);var b=this.children,d=b.length,e;for(e=0;e<d;e++)b[e]._.abs_y=this.abs_y-b[e].y,b[e].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(a){return},set abs_y(a){return},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(a){this._.width=a},get width(){return this._.width},set height(a){this._.height=a},get height(){return this._.height},set zIndex(a){!this.parent||(a==="front"&&(a=this.parent.children.length-1),a==="back"&&(a=0),this.core.draw.changeZorder(this.parent,this.zIndex,a))},get zIndex(){return this.parent&&this.parent.children.indexOf(this)},get drawn(){return this.core.draw.isCleared?!1:this._.drawn},set drawn(a){this._.drawn=!!a},bind:function(a,b){this.core.events.bind(this,a.split(" "),b);return this},unbind:function(a,b){this.core.events.unbind(this,a.split(" "),b);return this},trigger:function(a,b){var c=this.core.events,d=c.getParentChain(this,!0,!0);c.triggerChain(d,a.split(" "),c.fixEventObject(b));return this},add:function(a){this.added||(a=a!==c?a:!0,this.core.children.push(this),this.added=!0,this.parent=this.core,this.core.draw.objects.push(this),a&&this.core.draw.redraw());return this},remove:function(a){a=a!==c?a:!0;if(!this.parent)return this;var b=this.parent.children.indexOf(this);if(~b){this.parent.children.splice(b,1),this.parent=c,this.added=!1,this.drawn=!1;var d=this.core.draw.objects.indexOf(this);~d&&this.core.draw.objects.splice(f,1);var e=this.children;for(var f=0,g=e.length;f<g;f++)e[f].drawn=!1,d=this.core.draw.objects.indexOf(e[f]),~d&&this.core.draw.objects.splice(d,1);a&&this.core.draw.redraw()}return this},draw:function(){},redraw:function(){this.core.draw.redraw();return this},rotate:function(a){this.rotation+=a;return this},rotateTo:function(a){this.rotation=a;return this},getArgs:function(a,b,d,e){d=d||0,e=e||0;if(typeof b=="string"){var f=b,g=a;a=f==="x"?g:d,b=f==="y"?g:e}else b===c&&(b=a);return{x:a,y:b}},move:function(a,b){var c=this.getArgs(a,b);this.x+=c.x,this.y+=c.y;return this},moveTo:function(a,b){var c=this.getArgs(a,b,this.x,this.y);this.x=c.x,this.y=c.y;return this},scale:function(a,b){var c=this.getArgs(a,b,1,1);this.scalingX=c.x,this.scalingY=c.y;return this},scaleTo:function(a,b){var c=this.shapeType==="rectangular"?this.width:this.radius,d=this.shapeType==="rectangular"?this.height:this.radius,e=this.getArgs(a,b,c,d);e.x=e.x<=0?1:e.x,e.y=e.y<=0?1:e.y,this.scalingX=e.x/c,this.scalingX=e.y/d;return this},animate:function(){this.core.animation.animate(this,arguments);return this},stop:function(){this.core.animation.stop(this);return this},finish:function(){this.core.animation.finish(this);return this},delay:function(a,b){this.core.animation.delay(this,a,b);return this},fadeIn:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:1}].concat(a));return this},fadeOut:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:0}].concat(a));return this},fadeTo:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:a.splice(0,1)[0]}].concat(a));return this},dragAndDrop:function(a){a=a===c?{}:a;if(a===!1&&this.draggable===!0)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var b=this,d={x:0,y:0},e={x:0,y:0},f={x:0,y:0};this._.drag_start=function(c){a.bubble===!1&&c.stopPropagation(),this.dragging=!0,d.x=c.x-this.x,d.y=c.y-this.y,e.x=this.x,e.y=this.y,f=b.core.tools.transformPointerPosition(b,b.abs_x,b.abs_y,b.rotation),a.changeZindex===!0&&(this.zIndex="front"),typeof a.start=="function"&&a.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(c){b.dragging&&(a.bubble===!1&&c.stopPropagation(),b.dragging=!1,typeof a.end=="function"&&a.end.call(b),b.core.timeline.running||b.core.draw.redraw())},this._.drag_move=function(c){if(b.dragging){a.bubble===!1&&c.stopPropagation();var d=b.core.tools.transformPointerPosition(b,b.abs_x,b.abs_y,b.rotation);b.x=e.x+d.x-f.x,b.y=e.y+d.y-f.y,typeof a.move=="function"&&a.move.call(b),b.core.timeline.running||b.core.draw.redraw()}},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(a,b){this.origin.x=a,this.origin.y=b;return this},getOrigin:function(){var a,b,c=this.origin,d=this.shapeType;c.x==="center"?a=d==="rectangular"?this.width/2:0:c.x==="right"?a=d==="rectangular"?this.width:this.radius:c.x==="left"?a=d==="rectangular"?0:-this.radius:a=isNaN(parseFloat(c.x))?0:parseFloat(c.x),c.y==="center"?b=d==="rectangular"?this.height/2:0:c.y==="bottom"?b=d==="rectangular"?this.height:this.radius:c.y==="top"?b=d==="rectangular"?0:-this.radius:b=isNaN(parseFloat(c.y))?0:parseFloat(c.y);return{x:a,y:b}},addChild:function(a,b){if(a.parent===c){var d=this.children.push(a)-1;a.parent=this,a.x+=0,a.y+=0,this.core.draw.objects.push(a),this.drawn&&this.core.draw.redraw();if(b)return d}else if(b)return!1;return this},removeChild:function(a,b){var c=this.children.indexOf(a);~c&&this.removeChildAt(c,b);return this},removeChildAt:function(a,b){this.children[a]!==c&&this.children[a].remove(b);return this},clone:function(a){a=a||{},a.drawn=!1;var b=this.parent,e=this.core.display[this.type](a),f={},g=["core","events","children","parent","img","fill","strokeColor","added"],h=["abs_x","start_x","end_x"],i=["abs_y","start_y","end_y"],j,k,l,m,n,o,p,q,r;j=function(a,d){for(k in a){if(~g.indexOf(k))continue;r=Object.getPropertyDescriptor(a,k);if(r&&r.get===c){if(typeof a[k]=="object"){d[k]=a[k].constructor===Array?[]:{},j(a[k],d[k]);continue}var e=a[k];b&&(h.indexOf(k)>-1?e-=b.abs_x:i.indexOf(k)>-1&&(e-=b.abs_y)),d[k]=e}}},j(this,f),f.fill=this._.fill,l=this.core.style.getStroke(this.stroke),f.strokeColor=l.color,e=d.extend(e,f,a),e.id=++this.core.lastObjectID,typeof e.init=="function"&&e.init(),n=this.children;if(n.length>0)for(m=0;m<n.length;m++)o=n[m].clone(),e.children.push(o),o.parent=e,a.x&&(p=Math.abs(n[m].abs_x-this.x),o.x=p),a.y&&(q=Math.abs(n[m].abs_y-this.y),o.y=q);return e},isPointerInside:function(a){return this.core.tools.isPointerInside(this,a)}}},q=function(a,b,e,f){var g=this,h=this.core,i=function(c,f){return d.extend({core:f,type:a,shapeType:"rectangular",draw:function(){e.call(this,h.canvas,h);return this}},b,c)};this[a]=function(b){var e=d.extend(Object.create(p()),new i(b,h));f!==c&&typeof g[a][f]=="function"&&g[a][f]();return e};return g};d.registerModule("displayObject",p),d.registerModule("display",{wrapper:!0,register:q}),d.registerDisplayObject=function(a,b,e){d.registerModule("display."+a,{setCore:function(f){return function(g){var h=d.extend(Object.create(p()),new b(g,f));h.type=a,h.id=++f.lastObjectID,f.animation.queues.create(h,"default"),e!==c&&h[e]();return h}}})};var r=function(a,b){return d.extend({core:b,shapeType:"rectangular",draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath(),this.fill!==""&&(a.fillStyle=this.fill,a.fillRect(c,d,this.width,this.height)),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,this.strokePosition==="outside"?a.strokeRect(c-this.strokeWidth/2,d-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):this.strokePosition==="center"?a.strokeRect(c,d,this.width,this.height):this.strokePosition==="inside"&&a.strokeRect(c+this.strokeWidth/2,d+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),a.closePath();return this}},a)};d.registerDisplayObject("rectangle",r);var s=function(a,b){return d.extend({core:b,_:d.extend({},b.displayObject._,{hasBeenDrawn:!1}),shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,init:function(){var a=this,b;this.image!==c&&(this.img=new Image,this.img.onload=function(){a.loaded=!0,a.width!==0?a.height===0&&(a.height=a.width/(this.width/this.height)):a.width=this.width,a.height!==0?a.width===0&&(a.width=a.height/(this.height/this.width)):a.height=this.height,a.tile_width=a.tile_width===0?a.width:a.tile_width,a.tile_height=a.tile_height===0?a.height:a.tile_height,a._.hasBeenDrawn&&a.core.redraw()},this.img.src=this.image.src||this.image||"")},draw:function(){var a=this.core.canvas,b=this,d=this.getOrigin(),e=this.abs_x-d.x,f=this.abs_y-d.y,g,h;if(this.loaded&&this.core.draw.objects[this.zIndex]!==c&&this.img.width>0&&this.img.height>0){g=this.width===0?this.img.width:this.width,h=this.height===0?this.img.height:this.height;if(this.tile){var i=Math.ceil(g/this.tile_width),j=Math.ceil(h/this.tile_height),k,l;a.save(),a.beginPath(),a.moveTo(e,f),a.lineTo(e+g,f),a.lineTo(e+g,f+h),a.lineTo(e,f+h),a.lineTo(e,f),a.clip();for(l=0;l<j;l++)for(k=0;k<i;k++)a.drawImage(this.img,e+k*(this.tile_width+this.tile_spacing_x),f+l*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);a.closePath(),a.restore()}else a.drawImage(this.img,e,f,g,h);this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(e,f,g,h)),this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){b.draw()},100);this._.hasBeenDrawn=!0;return this}},a)};d.registerDisplayObject("image",s,"init");var t=[],u=function(a,c){var e=function(a,b,c,d,e){var f=e.style.getFont(a.font);f[b]=c,a._.font=e.style.getFont(f,"string"),d==="lineHeight"?(a._.lineHeight=isNaN(parseInt(c,10))?1:parseInt(c,10),a._.lineHeightUnit=typeof c=="string"?c.indexOf("px")>-1?"px":"relative":"relative"):a._[d]=c};return d.extend({core:c,shapeType:"rectangular",align:"start",baseline:"top",_:d.extend({},c.displayObject._,{hasBeenDrawn:!1,font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0,lines:[]}),set font(a){typeof a!="string"&&(a=this.core.style.getFont(a,"string"));var b=this.core.style.getFont(a);a=this.core.style.getFont(b,"string"),this._.style=b.style,this._.variant=b.variant,this._.weight=b.weight,this._.size=b.size,this._.lineHeight=b.lineHeight,this._.lineHeightUnit=b.lineHeightUnit,this._.family=b.family,this._.font=a,this.initWebFont(),this.setDimensions()},set style(a){e(this,"style",a,"style",this.core),this.initWebFont(),this.setDimensions()},set variant(a){e(this,"variant",a,"variant",this.core),this.initWebFont(),this.setDimensions()},set weight(a){e(this,"weight",a,"weight",this.core),this.initWebFont(),this.setDimensions()},set size(a){e(this,"size",a,"size",this.core),this.setDimensions()},set lineHeight(a){e(this,"lineHeight",a,"lineHeight",this.core),this.setDimensions()},set family(a){e(this,"family",a,"family",this.core),this.initWebFont(),this.setDimensions()},set text(a){this._.text=a,this.setDimensions()},set width(a){return},set height(a){return},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight+(this._.lineHeightUnit==="px"?"px":0)},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.initWebFont(),this.setDimensions()},setDimensions:function(){if(this._.initialized){var a,b,c,d,e,f,g,h,i;a=this.core.canvas,a.fillStyle=this.fill,a.font=this.font,b=(this.text+"").split("\n"),c=b.length,e=0,f=0,i=[];for(g=0;g<c;g++)h=a.measureText(b[g]),e=h.width>e?h.width:e,this._.lineHeightUnit==="px"?d=this._.lineHeight:d=this.size*this._.lineHeight,f+=d,i.push({text:b[g],width:h.width,height:d});this._.width=e,this._.height=f,this._.lines=i}},initWebFont:function(){var a=this.style+" "+this.variant+" "+this.weight+" 0px "+this.family;if(!(t.indexOf(a)>-1)){t.push(a);var c=this,d=this.core,e;e=b.createElement("span"),e.style.font=a,b.body.appendChild(e),setTimeout(function(){b.body.removeChild(e),c._.hasBeenDrawn&&d.redraw()},1e3)}},getAlignOffset:function(){var a={start:this.core.canvasElement.dir==="rtl"?-this.width:0,end:this.core.canvasElement.dir==="rtl"?0:-this.width,left:0,center:-this.width/2,right:-this.width};return a[this.align]||0},getBaselineOffset:function(){var a={top:this.size*.82,hanging:this.size*.65,middle:this.size*.31,alphabetic:0,ideographic:this.size*-0.05,bottom:this.size*-0.22};return a[this.baseline]||0},draw:function(){var a,b,c,d,e,f,g,h,i,j,k;a=this.core.canvas,b=this._.lines,c=this.getAlignOffset(),d=this.getBaselineOffset(),e=this._.lineHeightUnit==="px"?this._.lineHeight/this.size:this._.lineHeight,f=this.baseline!=="top"?this.size*(e-1)/2:0,g=this.getOrigin(),h=this.abs_x-g.x-c,i=this.abs_y-g.y+d-f,a.beginPath(),a.font=this.font,a.textAlign=this.align,a.textBaseline="alphabetic";if(this.strokeWidth>0){a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor;for(j=0,k=b.length;j<k;j++)a.strokeText(b[j].text,h,i+j*b[j].height+(b[j].height-this.size)/2)}if(this.fill!==""){a.fillStyle=this.fill;for(j=0,k=b.length;j<k;j++)a.fillText(b[j].text,h,i+j*b[j].height+(b[j].height-this.size)/2)}a.closePath(),this._.hasBeenDrawn=!0;return this}},a)};d.registerDisplayObject("text",u,"init");var v=function(a,b){return d.extend({core:b,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",pieSection:!1,draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;this.radius>0&&this.start!==this.end&&(a.beginPath(),this.pieSection&&a.moveTo(c,d),a.arc(c,d,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,this.direction==="anticlockwise"),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath());return this}},a)};d.registerDisplayObject("arc",v);var w=function(a,b){return d.extend({core:b,shapeType:"radial",_:d.extend({},b.displayObject._,{radius_x:0,radius_y:0}),set radius(a){this._.radius_x=a,this._.radius_y=a},set radius_x(a){this._.radius_x=a},set radius_y(a){this._.radius_y=a},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath();if(this.radius_x===this.radius_y)a.arc(c,d,this.radius_x,0,Math.PI*2,!1);else{var e=.276142374915397,f={x:this.radius_x*2*e,y:this.radius_y*2*e};a.moveTo(c-this.radius_x,d),a.bezierCurveTo(c-this.radius_x,d-f.y,c-f.x,d-this.radius_y,c,d-this.radius_y),a.bezierCurveTo(c+f.x,d-this.radius_y,c+this.radius_x,d-f.y,c+this.radius_x,d),a.bezierCurveTo(c+this.radius_x,d+f.y,c+f.x,d+this.radius_y,c,d+this.radius_y),a.bezierCurveTo(c-f.x,d+this.radius_y,c-this.radius_x,d+f.y,c-this.radius_x,d)}this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath();return this}},a)};d.registerDisplayObject("ellipse",w);var x=function(a,b){return d.extend({core:b,shapeType:"radial",sides:3,_:d.extend({},b.displayObject._,{radius:0,side:0}),set radius(a){this._.radius=a,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(a){this._.side=a,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y,e={x:0,y:0},f=this.sides,g=this.radius,h,i,j;a.beginPath();for(j=0;j<=f;j++)h=c+g*Math.cos(j*2*Math.PI/f),i=d+g*Math.sin(j*2*Math.PI/f),j===0?(a.moveTo(h,i),e={x:h,y:i}):j==f?a.lineTo(e.x,e.y):a.lineTo(h,i);a.closePath(),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke());return this}},a)};d.registerDisplayObject("polygon",x);var y=function(a,b){return d.extend({core:b,shapeType:"radial",_:d.extend({},b.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:0,y:0,abs_x:0,abs_y:0}),children:[],set start(a){this._.start_x=a.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.start_y=a.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},set end(a){this._.end_x=a.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.end_y=a.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},get start(){var a={x:0,y:0};this.parent&&!this.parent.isCore&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y);var b=this;return{get x(){return b._.start_x-a.x},get y(){return b._.start_y-a.y},set x(a){b._.start_x=a+(b.parent&&!b.parent.isCore?b.parent._.abs_x:0),b.setPosition()},set y(a){b._.start_y=a+(b.parent&&!b.parent.isCore?b.parent._.abs_y:0),b.setPosition()}}},get end(){var a={x:0,y:0};this.parent&&!this.parent.isCore&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y);var b=this;return{get x(){return b._.end_x-a.x},get y(){return b._.end_y-a.y},set x(a){b._.end_x=a+(b.parent&&!b.parent.isCore?b.parent._.abs_x:0),b.setPosition()},set y(a){b._.end_y=a+(b.parent&&!b.parent.isCore?b.parent._.abs_y:0),b.setPosition()}}},set x(a){var b,c,d,e,f;b=this._.end_x-this._.start_x,c=this.parent&&!this.parent.isCore?this.parent._.abs_x:0,this._.x=a,this._.abs_x=a+c,this._.start_x=a-b/2+c,this._.end_x=a+b/2+c,d=this.children,e=d.length;for(f=0;f<e;f++)d[f]._.abs_x=this.abs_x+d[f].x,d[f].x+=0},set y(a){var b,c,d,e,f;b=this._.end_y-this._.start_y,c=this.parent&&!this.parent.isCore?this.parent._.abs_y:0,this._.y=a,this._.abs_y=a+c,this._.start_y=a-b/2+c,this._.end_y=a+b/2+c,d=this.children,e=d.length;for(f=0;f<e;f++)d[f]._.abs_y=this.abs_y-d[f].y,d[f].y+=0},get x(){return this._.x},get y(){return this._.y},set length(a){var b,c,d,e;b=Math.abs(this._.end_x-this._.start_x),c=Math.abs(this._.end_y-this._.start_y),d=Math.sqrt(b*b+c*c),e=Math.asin(b/d),b=Math.sin(e)*a,c=Math.cos(e)*a,this._.end_x=this._.start_x+b,this._.end_y=this._.start_y+c,this.x+=0,this.y+=0,this.setPosition()},get length(){var a,b,c;a=Math.abs(this._.end_x-this._.start_x),b=Math.abs(this._.end_y-this._.start_y),c=Math.sqrt(a*a+b*b);return c},set radius(a){this.length=a*2},get radius(){return this.length/2},setPosition:function(){var a={x:0,y:0};this.parent&&!this.parent.isCore&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y),this.x=this._.start_x-a.x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y-a.y+(this._.end_y-this._.start_y)/2},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.core.draw.translation;a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.beginPath(),a.moveTo(this._.start_x-c.x-b.x,this._.start_y-c.y-b.y),a.lineTo(this._.end_x-c.x-b.x,this._.end_y-c.y-b.y),a.stroke(),a.closePath();return this}},a)};d.registerDisplayObject("line",y,"init");var z=function(a,b){return d.extend({core:b,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,numFrames:0,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,_:d.extend({},b.displayObject._,{autostart:!1}),set autostart(a){this.active=a,this._.autostart=a},get autostart(){return this._.autostart},init:function(){if(this.image!==c){var a=this,b=this.image.nodeName&&this.image.nodeName.toLowerCase()==="img"?"htmlImg":"newImg";this.img=b==="htmlImg"?this.image.cloneNode(!1):new Image,this.core.canvasElement.appendChild(this.img),this.img.onload=function(){a.full_width=this.width,a.full_height=this.height;if(a.generate){var b,c,d,e,f;b=a.direction,c=b==="y"?a.full_height:a.full_width,d=b==="y"?a.height:a.width,a.numFrames>0?e=a.numFrames:(e=c/d,a.numFrames=e),a.frames=[];for(f=0;f<e;f++)a.frames.push({x:a.offset_x+f*(b==="x"?a.width:0),y:a.offset_y+f*(b==="y"?a.height:0),d:a.duration})}a.core.canvasElement.removeChild(this),a.loaded=!0,a.core.redraw()},b==="newImg"&&(this.img.src=this.image)}},draw:function(){var a=this,b=this.core.canvas,d=this.getOrigin(),e=this.abs_x-d.x,f=this.abs_y-d.y,g;if(this.loaded){if(this.frames.length>0){if(this.frame>this.frames.length)return this;g=this.frames[this.frame-1],frame_width=g.w!==c?g.w:this.width,frame_height=g.h!==c?g.h:this.height,b.drawImage(this.img,g.x,g.y,frame_width,frame_height,e,f,frame_width,frame_height),this.strokeWidth>0&&(b.lineWidth=this.strokeWidth,b.strokeStyle=this.strokeColor,b.strokeRect(e,f,frame_width,frame_height)),this.running===!1&&this.active&&(setTimeout(function(){a.loop?a.frame=a.frame===a.frames.length?1:a.frame+1:a.frame=a.frame===a.frames.length?a.frame:a.frame+1,a.running=!1,a.core.timeline.running||a.core.draw.redraw()},g.d),this.running=!0)}this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){a.draw()},100);return this},start:function(){this.startAnimation();return this},startAnimation:function(){this.active=!0,this.core.redraw();return this},stopAnimation:function(){this.active=!1;return this}},a)};d.registerDisplayObject("sprite",z,"init")})(window,document),function(){"use strict";var a=Object.prototype,b=a.__defineGetter__,c=a.__defineSetter__,d=a.__lookupGetter__,e=a.__lookupSetter__,f=a.hasOwnProperty;b&&c&&d&&e&&(Object.defineProperty||(Object.defineProperty=function(a,g,h){if(arguments.length<3)throw new TypeError("Arguments not optional");g+="";if(f.call(h,"value")){!d.call(a,g)&&!e.call(a,g)&&(a[g]=h.value);if(f.call(h,"get")||f.call(h,"set"))throw new TypeError("Cannot specify an accessor and a value")}h.get&&b.call(a,g,h.get),h.set&&c.call(a,g,h.set);return a}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(a,b){if(arguments.length<2)throw new TypeError("Arguments not optional.");b+="";var c={configurable:!0,enumerable:!0,writable:!0},g=d.call(a,b),h=e.call(a,b);if(!f.call(a,b))return c;if(!g&&!h){c.value=a[b];return c}delete c.writable,c.get=c.set=undefined,g&&(c.get=g),h&&(c.set=h);return c}),Object.defineProperties||(Object.defineProperties=function(a,b){for(var c in b)f.call(b,c)&&Object.defineProperty(a,c,b[c])}))}()
},{}],3:[function(require,module,exports){
var __slice=Array.prototype.slice;(function(a){var b;return a.fn.sketch=function(){var c,d,e;d=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[],this.length>1&&a.error("Sketch.js can only be called on one element at a time."),e=this.data("sketch");if(typeof d!="string"||!e)return e?e:(this.data("sketch",new b(this.get(0),d)),this);if(!e[d])return a.error("Sketch.js did not recognize the given command.");if(typeof e[d]=="function")return e[d].apply(e,c);if(c.length===0)return e[d];if(c.length===1)return e[d]=c[0]},b=function(){function b(b,c){this.el=b,this.canvas=a(b),this.context=b.getContext("2d"),this.options=a.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},c),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.actions=[],this.action=[],this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&a("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(b){var c,d,e,f,g,h,i;d=a(this),c=a(d.attr("href")),f=c.data("sketch"),i=["color","size","tool"];for(g=0,h=i.length;g<h;g++)e=i[g],d.attr("data-"+e)&&f.set(e,a(this).attr("data-"+e));return a(this).attr("data-download")&&f.download(a(this).attr("data-download")),!1})}return b.prototype.download=function(a){var b;return a||(a="png"),a==="jpg"&&(a="jpeg"),b="image/"+a,window.open(this.el.toDataURL(b))},b.prototype.set=function(a,b){return this[a]=b,this.canvas.trigger("sketch.change"+a,b)},b.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},b.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},b.prototype.onEvent=function(b){return b.originalEvent&&b.originalEvent.targetTouches&&(b.pageX=b.originalEvent.targetTouches[0].pageX,b.pageY=b.originalEvent.targetTouches[0].pageY),a.sketch.tools[a(this).data("sketch").tool].onEvent.call(a(this).data("sketch"),b),b.preventDefault(),!1},b.prototype.redraw=function(){var b;this.el.width=this.canvas.width(),this.context=this.el.getContext("2d"),b=this,a.each(this.actions,function(){if(this.tool)return a.sketch.tools[this.tool].draw.call(b,this)});if(this.painting&&this.action)return a.sketch.tools[this.action.tool].draw.call(b,this.action)},b}(),a.sketch={tools:{}},a.sketch.tools.marker={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}if(this.painting)return this.action.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()},draw:function(a){var b,c,d,e,f;this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(a.events[0].x,a.events[0].y),f=a.events;for(d=0,e=f.length;d<e;d++)b=f[d],this.context.lineTo(b.x,b.y),c=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},a.sketch.tools.eraser={onEvent:function(b){return a.sketch.tools.marker.onEvent.call(this,b)},draw:function(b){var c;return c=this.context.globalCompositeOperation,this.context.globalCompositeOperation="copy",b.color="rgba(0,0,0,0)",a.sketch.tools.marker.draw.call(this,b),this.context.globalCompositeOperation=c}}})(jQuery)
},{}]},{},[1,2,3]);
